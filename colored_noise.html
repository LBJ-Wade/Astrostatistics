
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Colored Noise &#8212; Astrostatistics</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Populations and Catalogs" href="populations.html" />
    <link rel="prev" title="Regression and Curve Fitting" href="regression_and_curve_fitting.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Astrostatistics</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   PHY 688: Numerical Methods in Astrophysics.
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="welcome.html">
   An Example to Set the Stage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="syllabus.html">
   PHY 688: Computational Astrophysics Syllabus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="regression_and_curve_fitting.html">
   Regression and Curve Fitting
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Colored Noise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="populations.html">
   Populations and Catalogs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="selection_effects.html">
   Selection Effects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="special_methods.html">
   Special Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tips_and_tricks.html">
   Tips and Tricks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="project_ideas.html">
   Project Ideas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/colored_noise.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/farr/Astrostatistics"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/farr/Astrostatistics/issues/new?title=Issue%20on%20page%20%2Fcolored_noise.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/farr/Astrostatistics/main?urlpath=tree/astrostatistics/colored_noise.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#some-random-notes-from-lecture">
   Some random notes from Lecture
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-example-from-ligo">
   An Example from LIGO
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#state-space-models">
   State Space Models
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#keplerian-and-asteroseismology-in-rv">
   Keplerian and Asteroseismology in RV
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="colored-noise">
<h1>Colored Noise<a class="headerlink" href="#colored-noise" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pylab</span> inline
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;svg&#39;

<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="kn">import</span> <span class="nn">celerite2</span>
<span class="kn">from</span> <span class="nn">celerite2</span> <span class="kn">import</span> <span class="n">terms</span>
<span class="kn">from</span> <span class="nn">celerite2.theano</span> <span class="kn">import</span> <span class="n">terms</span> <span class="k">as</span> <span class="n">theano_terms</span>
<span class="kn">import</span> <span class="nn">celerite2.theano</span>
<span class="kn">import</span> <span class="nn">exoplanet</span> <span class="k">as</span> <span class="nn">xo</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pymc3</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">import</span> <span class="nn">pymc3_ext</span> <span class="k">as</span> <span class="nn">pmx</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">welch</span><span class="p">,</span> <span class="n">decimate</span>
<span class="kn">from</span> <span class="nn">scipy.signal.windows</span> <span class="kn">import</span> <span class="n">tukey</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">stan_jupyter</span> <span class="k">as</span> <span class="nn">stan</span>
<span class="kn">import</span> <span class="nn">theano.tensor</span> <span class="k">as</span> <span class="nn">T</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s1">&#39;notebook&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;ticks&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="s1">&#39;colorblind&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Populating the interactive namespace from numpy and matplotlib
</pre></div>
</div>
</div>
</div>
<div class="section" id="some-random-notes-from-lecture">
<h2>Some random notes from Lecture<a class="headerlink" href="#some-random-notes-from-lecture" title="Permalink to this headline">¶</a></h2>
<p>Correlated Noise</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Sigma</span> <span class="o">=</span> <span class="n">array</span><span class="p">([[</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.9</span><span class="p">],</span> <span class="p">[</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>

<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">xs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x1494969a0&gt;]
</pre></div>
</div>
<img alt="_images/colored_noise_5_1.svg" src="_images/colored_noise_5_1.svg" /></div>
</div>
<p>Here we made a Gaussian process with kernel
$<span class="math notranslate nohighlight">\(
k\left( x_i, x_j \right) = \sigma^2 \exp\left( -\frac{1}{2} \left(\frac{x_i - x_j}{\lambda} \right)^2 \right).
\)</span>$
For obvious reasons, this is called the “squared exponential kernel.”  A good place to learn a lot about Gaussian processes, kernel functions, etc, etc, is <span id="id1">[<a class="reference internal" href="bibliography.html#id12">Rasmussen and Williams, 2006</a>]</span>, which can be found online <a class="reference external" href="http://www.gaussianprocess.org/gpml/chapters/">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>

<span class="n">sigma2</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">lambda2</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="k">def</span> <span class="nf">k</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">xj</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sigma2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">xi</span><span class="o">-</span><span class="n">xj</span><span class="p">)</span><span class="o">/</span><span class="n">lambda2</span><span class="p">)</span>

<span class="n">Sigma</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span>
        <span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

<span class="n">imshow</span><span class="p">(</span><span class="n">Sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x149560eb0&gt;
</pre></div>
</div>
<img alt="_images/colored_noise_7_1.svg" src="_images/colored_noise_7_1.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="n">Sigma</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/colored_noise_8_0.svg" src="_images/colored_noise_8_0.svg" /></div>
</div>
<div class="math notranslate nohighlight">
\[
\rho(\tau) = \sigma^2 \exp\left( -\frac{\left| \tau \right|}{\lambda} \right)
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>

<span class="n">sigma2</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="k">def</span> <span class="nf">k</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">xj</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sigma2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xi</span><span class="o">-</span><span class="n">xj</span><span class="p">)</span><span class="o">/</span><span class="n">tau</span><span class="p">)</span>

<span class="n">Sigma</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span>
        <span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

<span class="n">imshow</span><span class="p">(</span><span class="n">Sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x1496c1bb0&gt;
</pre></div>
</div>
<img alt="_images/colored_noise_10_1.svg" src="_images/colored_noise_10_1.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="n">Sigma</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/colored_noise_11_0.svg" src="_images/colored_noise_11_0.svg" /></div>
</div>
</div>
<div class="section" id="an-example-from-ligo">
<h2>An Example from LIGO<a class="headerlink" href="#an-example-from-ligo" title="Permalink to this headline">¶</a></h2>
<p>I downloaded the Hanford LIGO data for GW150914 from <a class="reference external" href="https://www.gw-openscience.org/eventapi/html/GWTC-1-confident/GW150914/v3">GWOSC</a>.  There are a number of different data products there, but I grabbed the 4 kHz sample rate, 32 second long segment surrounding this event.  I also grabbed the “parameter estimation” posterior samples from the same place.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;data/H-H1_GWOSC_4KHZ_R1-1126259447-32.hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">strain</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;strain/Strain&#39;</span><span class="p">])</span>
    <span class="n">strain_start</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;meta/GPSstart&#39;</span><span class="p">])[()]</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">4096.0</span>
    <span class="n">strain_times</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">strain</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;data/GW150914_GWTC-1.hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">postsamples</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;Overall_posterior&#39;</span><span class="p">])</span>
<span class="n">t_approx</span> <span class="o">=</span> <span class="mf">1126259462.422</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">strain_times</span><span class="p">,</span> <span class="n">strain</span><span class="p">)</span>
<span class="n">axvline</span><span class="p">(</span><span class="n">t_approx</span> <span class="o">-</span> <span class="n">strain_start</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t / \mathrm</span><span class="si">{s}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$h(t)$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$h(t)$&#39;)
</pre></div>
</div>
<img alt="_images/colored_noise_16_1.svg" src="_images/colored_noise_16_1.svg" /></div>
</div>
<p>We know the 150914 signal ends at low frequency (&lt; 500 Hz), so we will decimate this data to 1024 sample rate (i.e. by a factor of 4):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lowpass_strain</span> <span class="o">=</span> <span class="n">decimate</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">lowpass_strain_times</span> <span class="o">=</span> <span class="n">strain_times</span><span class="p">[::</span><span class="mi">4</span><span class="p">]</span>
<span class="n">lowpass_dt</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="mi">4</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">seglen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">lowpass_dt</span><span class="p">))</span>
<span class="n">fs</span><span class="p">,</span> <span class="n">psd</span> <span class="o">=</span> <span class="n">welch</span><span class="p">(</span><span class="n">lowpass_strain</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">lowpass_dt</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">seglen</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loglog</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">psd</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f / \mathrm</span><span class="si">{Hz}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$P(f) / \mathrm</span><span class="si">{strain}</span><span class="s1">^2 \, \mathrm</span><span class="si">{Hz}</span><span class="s1">^{-1}$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$P(f) / \\mathrm{strain}^2 \\, \\mathrm{Hz}^{-1}$&#39;)
</pre></div>
</div>
<img alt="_images/colored_noise_20_1.svg" src="_images/colored_noise_20_1.svg" /></div>
</div>
<p>Let’s whiten the data: the PSD measures the density of the variance in frequency space, so the s.d. in a frequency bin is <span class="math notranslate nohighlight">\(\sqrt{P(f)*\delta f}\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">whiten</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">interp_psd</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="n">Nt</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="c1"># whitening: transform to freq domain, divide by asd, then transform back, </span>
    <span class="c1"># taking care to get normalization right.</span>
    <span class="n">hf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span>
    <span class="n">white_hf</span> <span class="o">=</span> <span class="n">hf</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">interp_psd</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">/</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
    <span class="n">white_ht</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span><span class="n">white_hf</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">Nt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">white_ht</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">white_strain</span> <span class="o">=</span> <span class="n">whiten</span><span class="p">(</span><span class="n">lowpass_strain</span><span class="p">,</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">psd</span><span class="p">),</span> <span class="n">lowpass_dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">lowpass_strain_times</span><span class="p">,</span> <span class="n">white_strain</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x147bf1c40&gt;]
</pre></div>
</div>
<img alt="_images/colored_noise_24_1.svg" src="_images/colored_noise_24_1.svg" /></div>
</div>
<p>Funky things happen at the end of the segment.  Why is that?  (Periodicity.)  It’s better to whiten a <em>windowed</em> version of the data that enforces periodicity.  Here we use a Tukey window (which tapers off to zero on either end over one-second intervals):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">strain_window</span> <span class="o">=</span> <span class="n">tukey</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lowpass_strain</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="o">/</span><span class="mi">32</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">lowpass_strain_times</span><span class="p">,</span> <span class="n">strain_window</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x147c3d940&gt;]
</pre></div>
</div>
<img alt="_images/colored_noise_26_1.svg" src="_images/colored_noise_26_1.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">white_strain</span> <span class="o">=</span> <span class="n">whiten</span><span class="p">(</span><span class="n">lowpass_strain</span><span class="o">*</span><span class="n">strain_window</span><span class="p">,</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">psd</span><span class="p">),</span> <span class="n">lowpass_dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">lowpass_strain_times</span><span class="p">,</span> <span class="n">white_strain</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x147ca8910&gt;]
</pre></div>
</div>
<img alt="_images/colored_noise_28_1.svg" src="_images/colored_noise_28_1.svg" /></div>
</div>
<p>And here’s our merger:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">imerg</span> <span class="o">=</span> <span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lowpass_strain_times</span> <span class="o">-</span> <span class="p">(</span><span class="n">t_approx</span> <span class="o">-</span> <span class="n">strain_start</span><span class="p">)))</span>
<span class="n">rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">imerg</span><span class="o">-</span><span class="mf">0.2</span><span class="o">/</span><span class="n">lowpass_dt</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">imerg</span><span class="o">+</span><span class="mf">0.05</span><span class="o">/</span><span class="n">lowpass_dt</span><span class="p">)))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">lowpass_strain_times</span><span class="p">[</span><span class="n">rng</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">t_approx</span><span class="o">-</span><span class="n">strain_start</span><span class="p">),</span> <span class="n">white_strain</span><span class="p">[</span><span class="n">rng</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t - t_c$ $(\mathrm</span><span class="si">{s}</span><span class="s1">)$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$h(t)$ (whitened)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$h(t)$ (whitened)&#39;)
</pre></div>
</div>
<img alt="_images/colored_noise_30_1.svg" src="_images/colored_noise_30_1.svg" /></div>
</div>
<p>A good place to go for discussions like what we are about to have is the <a class="reference external" href="https://arxiv.org/abs/1608.01940">“GW150914 basic physics” paper</a> <span id="id2">[<a class="reference internal" href="bibliography.html#id13">Abbott <em>et al.</em>, 2016</a>]</span>; for “real” post Newtonian expansions, see <span id="id3">[<a class="reference internal" href="bibliography.html#id14">Blanchet, 2014</a>]</span>.  The basic physics paper gives the evolution of the <em>inspiral</em> phase with time:
$<span class="math notranslate nohighlight">\(
\frac{1}{2\pi} \frac{\mathrm{d} \Phi}{\mathrm{d} t} = f_\mathrm{GW} = \frac{5^{3/8}}{\left( 8 \pi \right)} \left( \frac{G M_c}{c^3} \right)^{-5/8} \left( t - t_c \right)^{-3/8}
\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">lowpass_strain_times</span><span class="p">[</span><span class="n">rng</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">t_approx</span><span class="o">-</span><span class="n">strain_start</span><span class="p">)</span>
<span class="n">fs</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1100.0</span><span class="o">*</span><span class="p">(</span><span class="mf">4.9e-6</span><span class="o">*</span><span class="mf">20.0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ts</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="mf">8.0</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t / \mathrm</span><span class="si">{s}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f_{\mathrm</span><span class="si">{GW}</span><span class="s1">} / \mathrm</span><span class="si">{Hz}</span><span class="s1">$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/35/vcq24mtj2_g5wk96mbck0cw400018s/T/ipykernel_6604/3102124229.py:2: RuntimeWarning: invalid value encountered in power
  fs = (1100.0*(4.9e-6*20.0)**(5.0/3.0)*(-ts))**(-3.0/8.0)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$f_{\\mathrm{GW}} / \\mathrm{Hz}$&#39;)
</pre></div>
</div>
<img alt="_images/colored_noise_32_2.svg" src="_images/colored_noise_32_2.svg" /></div>
</div>
<p>Because the inspiral frequency reaches <span class="math notranslate nohighlight">\(\infty\)</span> in finite time, we will have to do something.  Here’s something:</p>
<ul class="simple">
<li><p>To truncate the frequency at some <span class="math notranslate nohighlight">\(f_\mathrm{max}\)</span> (a parameter).</p></li>
<li><p>To have an exponentially-damped amplitude decay once the frequency reaches <span class="math notranslate nohighlight">\(f_\mathrm{max}\)</span>.</p></li>
<li><p>To use a power-law amplitude with unknown index.</p></li>
</ul>
<p>So
$<span class="math notranslate nohighlight">\(
h(t) = A_{100} \left( \frac{f(t)}{100 \, \mathrm{Hz}} \right)^\alpha \cos \left( \phi_0 + \Phi(t) \right) \frac{1}{1 + \exp\left( \frac{t - t\left(f_\mathrm{max}\right)}{\tau} \right)}
\)</span><span class="math notranslate nohighlight">\(
with
\)</span><span class="math notranslate nohighlight">\(
f(t) = \begin{cases}
\left( \frac{\left( 8 \pi \right)^{8/3}}{5} \left( \frac{G \mathcal{M}}{c^3} \right)^{5/3} \left( t_c - t \right) \right)^{-3/8} &amp; f(t) &lt; f_\mathrm{max} \\
f_\mathrm{max} &amp; \mathrm{otherwise}
\end{cases}
\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">low_pass_filter_amplitude</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">frolloff</span><span class="p">,</span> <span class="n">fwidth</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">exp</span><span class="p">((</span><span class="n">fs</span> <span class="o">-</span> <span class="n">frolloff</span><span class="p">)</span><span class="o">/</span><span class="n">fwidth</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">basic_waveform</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">A100</span><span class="p">,</span> <span class="n">dlnAdlnf</span><span class="p">,</span> <span class="n">Mc</span><span class="p">,</span> <span class="n">tc</span><span class="p">,</span> <span class="n">phic</span><span class="p">,</span> <span class="n">max_freq</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1100.0</span><span class="o">*</span><span class="p">(</span><span class="mf">4.9e-6</span><span class="o">*</span><span class="n">Mc</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tc</span><span class="o">-</span><span class="n">ts</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="mf">8.0</span><span class="p">)</span>

    <span class="n">tmax</span> <span class="o">=</span> <span class="n">tc</span> <span class="o">-</span> <span class="n">max_freq</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">8.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1100.0</span><span class="o">*</span><span class="p">(</span><span class="mf">4.9e-6</span><span class="o">*</span><span class="n">Mc</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">))</span>
    
    <span class="n">Phiinsp</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="mf">8.0</span><span class="o">/</span><span class="mf">5.0</span><span class="o">*</span><span class="p">(</span><span class="mf">1100.0</span><span class="o">*</span><span class="p">(</span><span class="mf">4.9e-6</span><span class="o">*</span><span class="n">Mc</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="mf">8.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tc</span> <span class="o">-</span> <span class="n">ts</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">8.0</span><span class="p">)</span>
    <span class="n">Phiconst</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="mf">8.0</span><span class="o">/</span><span class="mf">5.0</span><span class="o">*</span><span class="p">(</span><span class="mf">1100.0</span><span class="o">*</span><span class="p">(</span><span class="mf">4.9e-6</span><span class="o">*</span><span class="n">Mc</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="mf">8.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tc</span> <span class="o">-</span> <span class="n">tmax</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">8.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">max_freq</span><span class="o">*</span><span class="p">(</span><span class="n">tmax</span><span class="o">-</span><span class="n">ts</span><span class="p">)</span>
    
    <span class="n">Phi</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">ts</span> <span class="o">&lt;</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">Phiinsp</span><span class="p">,</span> <span class="n">Phiconst</span><span class="p">)</span>
        
    <span class="n">fs</span><span class="p">[(</span><span class="n">fs</span> <span class="o">&gt;=</span> <span class="n">max_freq</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">ts</span> <span class="o">&gt;=</span> <span class="n">tc</span><span class="p">)]</span> <span class="o">=</span> <span class="n">max_freq</span>
    
    <span class="n">amps</span> <span class="o">=</span> <span class="n">A100</span><span class="o">*</span><span class="p">(</span><span class="n">fs</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="n">dlnAdlnf</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">low_pass_filter_amplitude</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span><span class="o">*</span><span class="n">amps</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">phic</span> <span class="o">-</span> <span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="n">low_pass_filter_amplitude</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">tau</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">basic_waveform</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">250.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">white_strain</span><span class="p">[</span><span class="n">rng</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t-t_\mathrm</span><span class="si">{GW150914}</span><span class="s1">$ ($\mathrm</span><span class="si">{s}</span><span class="s1">$)&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Whitened Strain&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/35/vcq24mtj2_g5wk96mbck0cw400018s/T/ipykernel_6604/4150586030.py:4: RuntimeWarning: invalid value encountered in power
  fs = (1100.0*(4.9e-6*Mc)**(5.0/3.0)*(tc-ts))**(-3.0/8.0)
/var/folders/35/vcq24mtj2_g5wk96mbck0cw400018s/T/ipykernel_6604/4150586030.py:8: RuntimeWarning: invalid value encountered in power
  Phiinsp = 2.0*pi*8.0/5.0*(1100.0*(4.9e-6*Mc)**(5.0/3.0))**(-3.0/8.0)*(tc - ts)**(5.0/8.0)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Whitened Strain&#39;)
</pre></div>
</div>
<img alt="_images/colored_noise_35_2.svg" src="_images/colored_noise_35_2.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;nt&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span>
    <span class="s1">&#39;ts&#39;</span><span class="p">:</span> <span class="n">ts</span><span class="p">,</span>
    <span class="s1">&#39;h_obs&#39;</span><span class="p">:</span> <span class="n">white_strain</span><span class="p">[</span><span class="n">rng</span><span class="p">]</span>
<span class="p">}</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;stan/phenom_model.stan&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">program_code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">Building:</span> found in cache, done.
<span class=" -Color -Color-Cyan">Messages from </span><span class=" -Color -Color-Bold -Color-Bold-Cyan">stanc</span><span class=" -Color -Color-Cyan">:</span>
Warning in &#39;/var/folders/35/vcq24mtj2_g5wk96mbck0cw400018s/T/httpstan_zxfqm9oh/model_qsspgd2o.stan&#39;, line 138, column 19: Argument 0.01 suggests there may be parameters that are not unit scale; consider rescaling with a multiplier (see manual section 22.12).
Warning in &#39;/var/folders/35/vcq24mtj2_g5wk96mbck0cw400018s/T/httpstan_zxfqm9oh/model_qsspgd2o.stan&#39;, line 16, column 29: The variable fs may not have been assigned a value before its use.
Warning: The parameter phi_x has no priors.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_pystan</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Cyan">Sampling:</span>   0%
<span class=" -Color -Color-Cyan">Sampling:</span>   0% (1/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>   0% (2/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>   0% (3/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>   0% (4/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>   1% (103/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>   3% (203/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>   4% (302/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>   5% (401/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>   6% (501/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>   8% (600/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>   9% (700/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  10% (800/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  11% (900/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  12% (1000/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  14% (1100/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  15% (1200/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  16% (1300/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  18% (1400/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  19% (1500/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  20% (1600/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  21% (1700/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  22% (1800/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  24% (1900/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  25% (2000/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  26% (2100/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  28% (2200/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  29% (2300/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  30% (2400/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  31% (2500/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  32% (2600/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  34% (2700/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  35% (2800/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  36% (2900/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  38% (3000/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  39% (3100/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  40% (3201/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  41% (3301/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  43% (3402/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  44% (3501/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  45% (3601/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  46% (3700/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  48% (3800/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  49% (3901/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  50% (4001/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  51% (4101/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  53% (4201/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  54% (4300/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  55% (4400/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  56% (4500/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  58% (4600/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  59% (4700/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  60% (4800/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  61% (4900/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  62% (5000/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  64% (5100/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  65% (5200/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  66% (5300/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  68% (5400/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  69% (5500/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  70% (5600/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  71% (5700/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  72% (5800/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  74% (5900/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  75% (6000/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  76% (6100/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  78% (6200/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  79% (6301/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  80% (6401/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  81% (6501/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  83% (6601/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  84% (6700/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  85% (6800/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  86% (6900/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  88% (7000/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  89% (7100/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  90% (7200/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  91% (7300/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  92% (7400/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  94% (7500/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  95% (7600/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  96% (7700/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  98% (7800/8000)
<span class=" -Color -Color-Cyan">Sampling:</span>  99% (7900/8000)
<span class=" -Color -Color-Cyan">Sampling:</span> 100% (8000/8000)
<span class=" -Color -Color-Green">Sampling:</span> 100% (8000/8000), done.
<span class=" -Color -Color-Cyan">Messages received during sampling:</span>
  Gradient evaluation took 0.000112 seconds
  1000 transitions using 10 leapfrog steps per transition would take 1.12 seconds.
  Adjust your expectations accordingly!
  Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:
  Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in &#39;/var/folders/35/vcq24mtj2_g5wk96mbck0cw400018s/T/httpstan_60ciys2i/model_qsspgd2o.stan&#39;, line 131, column 2 to column 33)
  If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,
  but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.
  Gradient evaluation took 0.000211 seconds
  1000 transitions using 10 leapfrog steps per transition would take 2.11 seconds.
  Adjust your expectations accordingly!
  Gradient evaluation took 0.000205 seconds
  1000 transitions using 10 leapfrog steps per transition would take 2.05 seconds.
  Adjust your expectations accordingly!
  Gradient evaluation took 0.000205 seconds
  1000 transitions using 10 leapfrog steps per transition would take 2.05 seconds.
  Adjust your expectations accordingly!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A100&#39;</span><span class="p">,</span> <span class="s1">&#39;dlnAdlnf&#39;</span><span class="p">,</span> <span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="s1">&#39;tc&#39;</span><span class="p">,</span> <span class="s1">&#39;Mc&#39;</span><span class="p">,</span> <span class="s1">&#39;max_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[&lt;AxesSubplot:title={&#39;center&#39;:&#39;A100&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;A100&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;dlnAdlnf&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;dlnAdlnf&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;phi&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;phi&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;tc&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;tc&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;Mc&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;Mc&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;max_freq&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;max_freq&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;tau&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;tau&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;sigma&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;sigma&#39;}&gt;]], dtype=object)
</pre></div>
</div>
<img alt="_images/colored_noise_38_1.svg" src="_images/colored_noise_38_1.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">fit</span><span class="o">.</span><span class="n">posterior</span><span class="o">.</span><span class="n">h_model</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">white_strain</span><span class="p">[</span><span class="n">rng</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t-t_\mathrm</span><span class="si">{GW150914}</span><span class="s1">$ ($\mathrm</span><span class="si">{s}</span><span class="s1">$)&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Whitened Strain&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Whitened Strain&#39;)
</pre></div>
</div>
<img alt="_images/colored_noise_39_1.svg" src="_images/colored_noise_39_1.svg" /></div>
</div>
<p>Note: the “real” value of <span class="math notranslate nohighlight">\(M_c\)</span> is <span class="math notranslate nohighlight">\(\sim 30 \, M_\odot\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="s1">&#39;Mc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Mc&#39;}&gt;
</pre></div>
</div>
<img alt="_images/colored_noise_41_1.svg" src="_images/colored_noise_41_1.svg" /></div>
</div>
</div>
<div class="section" id="state-space-models">
<h2>State Space Models<a class="headerlink" href="#state-space-models" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="n">sigma2</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="k">def</span> <span class="nf">k</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">xj</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sigma2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xi</span><span class="o">-</span><span class="n">xj</span><span class="p">)</span><span class="o">/</span><span class="n">tau</span><span class="p">)</span>

<span class="n">Sigma</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">Sigma</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

<span class="n">imshow</span><span class="p">(</span><span class="n">Sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x14ae52520&gt;
</pre></div>
</div>
<img alt="_images/colored_noise_43_1.svg" src="_images/colored_noise_43_1.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="n">Sigma</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/colored_noise_44_0.svg" src="_images/colored_noise_44_0.svg" /></div>
</div>
<p>Real term corresponds to
$<span class="math notranslate nohighlight">\(
\rho(t) = a \exp\left( c t \right)
\)</span>$</p>
<div class="math notranslate nohighlight">
\[
\frac{\mathrm{d} y}{\mathrm{d} t} + \frac{y}{\tau} = n
\]</div>
<div class="math notranslate nohighlight">
\[
\left\langle n \right\rangle = 0
\]</div>
<div class="math notranslate nohighlight">
\[
\left\langle n(t) n(t') \right\rangle = \sigma^2 \delta(t - t')
\]</div>
<div class="math notranslate nohighlight">
\[
P_y(f) \sim \frac{\sigma^2 \tau}{1 + \left( 2 \pi f \tau\right)^2}
\]</div>
<div class="math notranslate nohighlight">
\[
y(t) = y\left( t_0 \right) \exp\left( -\frac{t-t_0}{\tau} \right) + \int_0^t \mathrm{d} s \, \exp\left( -\frac{t-s}{\tau} \right) n(s)
\]</div>
<div class="math notranslate nohighlight">
\[
\left\langle y(t) y(t') \right\rangle = \frac{\sigma^2}{\tau} \exp\left( -\frac{\left| t - t' \right|}{\tau} \right)
\]</div>
<p>Finite Difference analog:</p>
<div class="math notranslate nohighlight">
\[
y_{i+1} - a y_i = n_{i+1}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a_true</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">c_true</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">terms</span><span class="o">.</span><span class="n">RealTerm</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a_true</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c_true</span><span class="p">)</span>
<span class="n">gp</span> <span class="o">=</span> <span class="n">celerite2</span><span class="o">.</span><span class="n">GaussianProcess</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">cumsum</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">1024</span><span class="p">))</span><span class="o">/</span><span class="mi">512</span>
<span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x14ada1b50&gt;]
</pre></div>
</div>
<img alt="_images/colored_noise_49_1.svg" src="_images/colored_noise_49_1.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gp</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/colored_noise_51_0.svg" src="_images/colored_noise_51_0.svg" /></div>
</div>
<p>Likelihood:
$<span class="math notranslate nohighlight">\(
p\left( \left\{ y_i \mid i = 1, \ldots N \right\} \mid a, c \right) = p\left( y_1 \mid a, c \right) \times p\left( y_2 \mid y_1, a, c \right) \times p\left( y_3 \mid y_2, y_1, a, c\right) \ldots
\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ys</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">celerite_model</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">theano_terms</span><span class="o">.</span><span class="n">RealTerm</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
    <span class="n">gp</span> <span class="o">=</span> <span class="n">celerite2</span><span class="o">.</span><span class="n">theano</span><span class="o">.</span><span class="n">GaussianProcess</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
    <span class="n">gp</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">marginal</span><span class="p">(</span><span class="s1">&#39;likelihood&#39;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">ys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">celerite_model</span><span class="p">:</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pmx</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/pymc3_ext/sampling/sampling.py:97: FutureWarning: In v4.0, pm.sample will return an `arviz.InferenceData` object instead of a `MultiTrace` by default. You can pass return_inferencedata=True or return_inferencedata=False to be safe and silence this warning.
  return pm.sample(draws=draws, tune=tune, model=model, step=step, **kwargs)
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [c, a]
</pre></div>
</div>
<div class="output text_html">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='4000' class='' max='4000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [4000/4000 00:13<00:00 Sampling 2 chains, 0 divergences]
</div>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 2 chains for 1_000 tune and 1_000 draw iterations (2_000 + 2_000 draws total) took 29 seconds.
ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

The acceptance probability does not match the target. It is 0.9599042519267924, but should be close to 0.9. Try to increase the number of tuning steps.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">celerite_model</span><span class="p">:</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">a_true</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">c_true</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;

ERROR (theano.graph.opt): Optimization failure due to: local_join_empty
ERROR (theano.graph.opt): node: Join(TensorConstant{0}, Elemwise{exp,no_inplace}.0, TensorConstant{[]}, TensorConstant{[]})
ERROR (theano.graph.opt): TRACEBACK:
ERROR (theano.graph.opt): Traceback (most recent call last):
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 2017, in process_node
    replacements = lopt.transform(fgraph, node)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4181, in local_join_empty
    ret = tt.patternbroadcast(ret, node.outputs[0].broadcastable)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/basic.py&quot;, line 4181, in patternbroadcast
    return theano.tensor.opt.apply_rebroadcast_opt(rval)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4103, in apply_rebroadcast_opt
    rval2 = local_rebroadcast_lift.transform(None, rval.owner)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/graph/opt.py&quot;, line 1209, in transform
    return self.fn(*args, **kwargs)
  File &quot;/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/theano/tensor/opt.py&quot;, line 4046, in local_rebroadcast_lift
    if len(fgraph.clients[input]) == 1:
AttributeError: &#39;NoneType&#39; object has no attribute &#39;clients&#39;
</pre></div>
</div>
<img alt="_images/colored_noise_56_1.svg" src="_images/colored_noise_56_1.svg" /></div>
</div>
<div class="math notranslate nohighlight">
\[
\prod_{i=1}^p \left[ \frac{\mathrm{d}}{\mathrm{d} t} - r_i \right] y(t) = \prod_{j=1}^q \left[ \frac{\mathrm{d} }{\mathrm{d} t} - b_i \right] n(t)
\]</div>
<p>Recall:
$<span class="math notranslate nohighlight">\(
q &lt; p
\)</span>$
for finite variance.</p>
<div class="math notranslate nohighlight">
\[
P_y(f) = \sigma^2 \frac{\prod_{j=1}^q \left| \left(2\pi i f\right) - b_j \right|^2}{\prod_{i=1}^p \left| \left(2 \pi i f \right) - r_i \right|^2}
\]</div>
<div class="math notranslate nohighlight">
\[
P_y \to \frac{1}{f^{2p - 2q}}
\]</div>
<p>as
$<span class="math notranslate nohighlight">\(
f \to \infty
\)</span>$</p>
<p>CARMA(<span class="math notranslate nohighlight">\(p\)</span>, <span class="math notranslate nohighlight">\(q\)</span>)</p>
<div class="math notranslate nohighlight">
\[
r_i = \gamma + 2\pi i f
\]</div>
<div class="math notranslate nohighlight">
\[
Q = \frac{\pi f}{\gamma}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">omegas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
<span class="n">Qs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="n">variances</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">terms</span><span class="o">.</span><span class="n">SHOTerm</span><span class="p">(</span><span class="n">Q</span><span class="o">=</span><span class="n">Qs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sqrt</span><span class="p">(</span><span class="n">variances</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">w0</span><span class="o">=</span><span class="n">omegas</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)])</span>
<span class="n">gp</span> <span class="o">=</span> <span class="n">celerite2</span><span class="o">.</span><span class="n">GaussianProcess</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dts</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">rand</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">cumsum</span><span class="p">(</span><span class="n">dts</span><span class="p">)</span>
<span class="n">gp</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x14afb3d00&gt;]
</pre></div>
</div>
<img alt="_images/colored_noise_61_1.svg" src="_images/colored_noise_61_1.svg" /></div>
</div>
<div class="math notranslate nohighlight">
\[
p\left( y_1 \mid \vec{A}, \vec{Q}, \vec{\omega}_0 \right) \times p\left( y_2 \mid y_1, \vec{A}, \vec{Q}, \vec{\omega}_0 \right) \times p\left( y_3 \mid y_2, y_1, \vec{A}, \vec{Q}, \vec{\omega}_0 \right) \times \ldots
\]</div>
<div class="math notranslate nohighlight">
\[
N\left[ 0, \Sigma\left(\vec{A}, \vec{Q}, \vec{\omega}_0 \right) \right]\left( y_1 \right) \times N\left[ \mu\left( t_2 \mid y_1 \right), \Sigma\left(t_2 - t_1 \mid \vec{A}, \vec{Q}, \vec{\omega}_0  \right) \right]\left( y_2 \right) \times N\left[ \mu\left( t_3 \mid y_2, y_1 \right), \Sigma\left(t_3 - t_2 \mid \vec{A}, \vec{Q}, \vec{\omega}_0  \right) \right]\left( y_3 \right) \times \ldots
\]</div>
<p><a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2014ApJ...788...33K/abstract">Kelly, et al. (2014)</a> or <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2017AJ....154..220F/abstract">Foreman-Mackey, et al. (2017)</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">kernel</span><span class="o">.</span><span class="n">get_psd</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$P_y(f)$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$P_y(f)$&#39;)
</pre></div>
</div>
<img alt="_images/colored_noise_63_1.svg" src="_images/colored_noise_63_1.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var</span><span class="p">(</span><span class="n">ys</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1.9372381767218398, 2.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Nmode</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">sho_model</span><span class="p">:</span>
    <span class="n">sigmas</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;sigmas&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">Nmode</span><span class="p">)</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">Nmode</span><span class="p">)</span>
    <span class="n">Qs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;Qs&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">Nmode</span><span class="p">)</span>
    
    <span class="n">gp</span> <span class="o">=</span> <span class="n">celerite2</span><span class="o">.</span><span class="n">theano</span><span class="o">.</span><span class="n">GaussianProcess</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">theano_terms</span><span class="o">.</span><span class="n">SHOTerm</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">sigmas</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Q</span><span class="o">=</span><span class="n">Qs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">w0</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nmode</span><span class="p">)]))</span>
    <span class="n">gp</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">marginal</span><span class="p">(</span><span class="s1">&#39;likelihood&#39;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">ys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">sho_model</span><span class="p">:</span>
    <span class="n">sho_trace</span> <span class="o">=</span> <span class="n">pmx</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Dan Simpson GP Tutorial: <a class="reference external" href="https://dansblog.netlify.app/posts/2021-11-03-yes-but-what-is-a-gaussian-process-or-once-twice-three-times-a-definition-or-a-descent-into-madness/">https://dansblog.netlify.app/posts/2021-11-03-yes-but-what-is-a-gaussian-process-or-once-twice-three-times-a-definition-or-a-descent-into-madness/</a></p>
</div>
<div class="section" id="keplerian-and-asteroseismology-in-rv">
<h2>Keplerian and Asteroseismology in RV<a class="headerlink" href="#keplerian-and-asteroseismology-in-rv" title="Permalink to this headline">¶</a></h2>
<p>Here we will reproduce the results of <span id="id4">[<a class="reference internal" href="bibliography.html#id15">Farr <em>et al.</em>, 2018</a>]</span>.  The data for that paper live <a class="reference external" href="https://github.com/farr/Aldebaran">here</a>; I have downloaded them and present them here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dsnames</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s2">&quot;table3.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;CFHT&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;table4.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;DAO&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;table5.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;McDonald 2.1m&quot;</span><span class="p">),</span> 
                <span class="p">(</span><span class="s2">&quot;table6.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;McDonald 2.7m&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;table7.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;McDonald 2.7m + Tull&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;table8.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;TLS&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;table9.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;BOAO&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;tablesong.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;SONG&quot;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fnames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dataframes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;data/Aldebaran/*.dat&quot;</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="n">fnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
    <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;rv&#39;</span><span class="p">,</span> <span class="s1">&#39;rv_uncert&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>Observations of Aldebaran come from several different instruments over several tens of years:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span>
<span class="k">with</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;husl&#39;</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="n">Ns</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fnames</span><span class="p">,</span> <span class="n">dataframes</span><span class="p">):</span>
        <span class="n">errorbar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rv&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rv&#39;</span><span class="p">]),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rv_uncert&#39;</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">dsnames</span><span class="p">[</span><span class="n">fn</span><span class="p">])</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;BJD (d)&#39;</span><span class="p">)</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$v_r$ ($\mathrm</span><span class="si">{m}</span><span class="s1"> \, \mathrm</span><span class="si">{s}</span><span class="s1">^{-1}$)&#39;</span><span class="p">)</span>
    <span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/colored_noise_73_0.svg" src="_images/colored_noise_73_0.svg" /></div>
</div>
<p>It is customary to give asteroseismic frequencies in micro-Hz; <span class="math notranslate nohighlight">\(1 \, \mu\mathrm{Hz} \simeq 1 / \left( 12 \, \mathrm{d} \right)\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu_Hz_day</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">3600.0</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span>
<span class="n">mu_Hz_day</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>11.574074074074073
</pre></div>
</div>
</div>
</div>
<p>Here we build the model that we discussed in class.  The RV measured at instrument <span class="math notranslate nohighlight">\(i\)</span> at time <span class="math notranslate nohighlight">\(t_j\)</span> is modeled as a sum of a Keplerian RV from a high-mass planet orbiting Aldebaran, a GP with two terms in the kernel—an exponential term for granulation noise on very long timescales, and an SHO term representing an un-resolved superposition of asteroseismic modes whose amplitude peaks at some frequency <span class="math notranslate nohighlight">\(\nu_\mathrm{max}\)</span>—for the stellar surface motion, a site-dependent constant RV offset, and a measurement noise:</p>
<div class="math notranslate nohighlight">
\[
v_{r,i}\left( t_j \right) = v_{r,\mathrm{Kepler}}\left( t_j \right) + v_{r, \mathrm{stellar}}\left( t_j \right) + v_{0,i} + \epsilon_{ij}
\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[
\epsilon_{ij} \sim N\left( 0, f_i \sigma_i\left( t_j \right) \right)
\]</div>
<p>is the measurement noise term, assumed to be a zero-mean Gaussian with s.d. given by a site-dependent scale factor <span class="math notranslate nohighlight">\(f_i\)</span> times the reported measurement uncertainty for site <span class="math notranslate nohighlight">\(i\)</span> at time <span class="math notranslate nohighlight">\(j\)</span>.</p>
<p>Doing a minor bit of algebra, we have</p>
<div class="math notranslate nohighlight">
\[
v_{r, \mathrm{stellar}}\left( t_j \right) + \epsilon_{ij} = v_{r,i}\left( t_j \right) - v_{r,\mathrm{Kepler}}\left( t_j \right) - v_{0,i},
\]</div>
<p>which isolates the “stochastic” terms on the left from the “deterministic” terms on the right.  <code class="docutils literal notranslate"><span class="pre">celerite2</span></code> is capable of handling the combined covariance matrix for the LHS, which consists of the sum of an exponential kernel, an SHO kernel, and a diagonal (a “white” kernel) covariance <span class="math notranslate nohighlight">\(\sim \epsilon^2\)</span>.</p>
<p>As usual, we re-center the measurement time series on the median sampled time for better stability in the fit (otherwise we are inferring the time of the pericentre passage closest to Julian day 0 (Monday, 1 January 4713 BC!), which is not a thing that is well-constrained, generating horrible degeneracies with the period—tiny changes in the period couple to tiny shifts in the time of percentre passage observed at Stonehenge near the end of the neolithic era to produce the same RV curve we see today!).</p>
<p>Because our RV measurements are a mix of “intrinsic” and “site-specific” effects, we compute some index gymnastics to keep track of which site is associated to each RV measurement below; then we feed a (sorted) array of times, RVs, measurement uncertainty, and site indices to the model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ninst</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span>

<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">])</span>
<span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">ind</span><span class="o">*</span><span class="n">ones_like</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)])</span>
<span class="n">raw_rvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rv&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">])</span>
<span class="n">raw_rv_uncerts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rv_uncert&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">])</span>

<span class="n">time_sort_index</span> <span class="o">=</span> <span class="n">argsort</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>

<span class="n">tmid</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>

<span class="n">sorted_times</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">time_sort_index</span><span class="p">]</span> <span class="o">-</span> <span class="n">tmid</span>
<span class="n">sorted_raw_rvs</span> <span class="o">=</span> <span class="n">raw_rvs</span><span class="p">[</span><span class="n">time_sort_index</span><span class="p">]</span>
<span class="n">sorted_raw_rv_uncerts</span> <span class="o">=</span> <span class="n">raw_rv_uncerts</span><span class="p">[</span><span class="n">time_sort_index</span><span class="p">]</span>
<span class="n">sorted_indexes</span> <span class="o">=</span> <span class="n">indexes</span><span class="p">[</span><span class="n">time_sort_index</span><span class="p">]</span>

<span class="n">instrument_mean_rvs</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rv&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">])</span>
<span class="n">instrument_std_rvs</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rv&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">])</span>

<span class="n">ts_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sorted_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sorted_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">mu_Hz_day</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># uniform in log from ~1/100 of nu_max to 100*nu_max</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">log</span><span class="p">(</span><span class="mf">100.0</span><span class="p">),</span> <span class="mi">1024</span><span class="p">))</span>

<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">aldeb_model</span><span class="p">:</span>
    <span class="c1"># Aosc in m/s is the RMS amplitude of the mode superposition.</span>
    <span class="n">Aosc</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;Aosc&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Qosc</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bound</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">10</span><span class="p">)(</span><span class="s1">&#39;Qosc&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># fmax (== nu_max) in muHz</span>
    <span class="n">fmax</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;fmax&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    
    <span class="c1"># Agran in m/s is the RMS amplitude of the granulation signal</span>
    <span class="n">Agran</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;Agran&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># In days!  (For no good reason---just because I was sloppy in class.)</span>
    <span class="n">taugran</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;taugran&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># RV semi-amplitude in m/s</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Period in days</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">630</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
    <span class="c1"># Eccentricity vector gives e = |A|, omega = arg(A):</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">pmx</span><span class="o">.</span><span class="n">UnitDisk</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;omega&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="c1"># The &quot;phase&quot; of t0.  This is a trick: if we choose a 2D vector with N(0, 1) </span>
    <span class="c1"># prior on each component, then its angles will be uniformly distributed, but </span>
    <span class="c1"># with the correct topology: angles crossing from -pi to +pi will be near each </span>
    <span class="c1"># other in this parameter space, while the obvious definition </span>
    <span class="c1"># phi0 = pm.Uniform(&#39;phi0&#39;, 0, 2*pi) has a discontinuity there.</span>
    <span class="n">phi0_vec</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;phi0_vec&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">phi0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;phi0&#39;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">phi0_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">phi0_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;t0&quot;</span><span class="p">,</span> <span class="n">P</span><span class="o">*</span><span class="n">phi0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">))</span>
    
    <span class="c1"># RV offset at each site, in units of that site&#39;s RV s.d., about the mean of the observed RVs.</span>
    <span class="n">dvr0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;dvr0&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">Ninst</span><span class="p">)</span>
    <span class="c1"># Actual RV offset in m/s</span>
    <span class="n">vr0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;vr0&#39;</span><span class="p">,</span> <span class="n">instrument_mean_rvs</span> <span class="o">+</span> <span class="n">instrument_std_rvs</span><span class="o">*</span><span class="n">dvr0</span><span class="p">)</span>
    
    <span class="c1"># RV measurement error scaling factor for each site.</span>
    <span class="n">funcert</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;funcert&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">Ninst</span><span class="p">)</span>
    
    <span class="c1"># Construct the orbit.</span>
    <span class="n">orbit</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">orbits</span><span class="o">.</span><span class="n">KeplerianOrbit</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">P</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">ecc</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">)</span>
    
    <span class="c1"># The Kepler part of the RV signal.</span>
    <span class="n">rv_kepler</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;v_r_kepler&quot;</span><span class="p">,</span> <span class="n">orbit</span><span class="o">.</span><span class="n">get_radial_velocity</span><span class="p">(</span><span class="n">sorted_times</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">))</span>

    <span class="c1"># Construct the GP with two terms in the kernel.</span>
    <span class="n">gp</span> <span class="o">=</span> <span class="n">celerite2</span><span class="o">.</span><span class="n">theano</span><span class="o">.</span><span class="n">GaussianProcess</span><span class="p">(</span><span class="n">theano_terms</span><span class="o">.</span><span class="n">RealTerm</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">Agran</span><span class="o">*</span><span class="n">Agran</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">taugran</span><span class="p">)</span> <span class="o">+</span>
                                          <span class="n">theano_terms</span><span class="o">.</span><span class="n">SHOTerm</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">Aosc</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="n">Qosc</span><span class="p">,</span> <span class="n">w0</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fmax</span><span class="o">/</span><span class="n">mu_Hz_day</span><span class="p">))</span>
    
    <span class="c1"># Factorize the GP covariance matrix, including the diagonal measurement error term (scaled by the site-specific factor)</span>
    <span class="n">gp</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">sorted_times</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sorted_raw_rv_uncerts</span><span class="o">*</span><span class="n">funcert</span><span class="p">[</span><span class="n">sorted_indexes</span><span class="p">])</span>
    
    <span class="c1"># This is the &quot;stochastic&quot; part of the RV signal; note the index tricks to apply the constant RV offset</span>
    <span class="n">rv_residual</span> <span class="o">=</span> <span class="n">sorted_raw_rvs</span> <span class="o">-</span> <span class="n">rv_kepler</span> <span class="o">-</span> <span class="n">vr0</span><span class="p">[</span><span class="n">sorted_indexes</span><span class="p">]</span>
    
    <span class="n">rv_stellar_mean</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;v_r_stellar_mean&#39;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">rv_residual</span><span class="p">))</span>
    
    <span class="c1"># Here is the likelihood function:</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">marginal</span><span class="p">(</span><span class="s1">&#39;stellar_rv_likelihood&#39;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">rv_residual</span><span class="p">)</span>
    
    <span class="c1"># Now we output a bunch of derived quantities.</span>
    <span class="c1"># First the PSD:</span>
    <span class="n">psd</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;psd&#39;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">get_psd</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fs</span><span class="o">/</span><span class="n">mu_Hz_day</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">mu_Hz_day</span><span class="p">)</span>
    
    <span class="c1"># We also record the keplerian and expected stellar component on a dense grid of times for plotting later</span>
    <span class="n">rv_kepler_pred</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;v_r_kepler_pred&#39;</span><span class="p">,</span> <span class="n">orbit</span><span class="o">.</span><span class="n">get_radial_velocity</span><span class="p">(</span><span class="n">ts_pred</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">))</span>
    <span class="n">rv_stellar_pred_mean</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;v_r_stellar_pred_mean&#39;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">rv_residual</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">ts_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">aldeb_model</span><span class="p">:</span>
    <span class="n">aldeb_trace</span> <span class="o">=</span> <span class="n">pmx</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/pymc3_ext/sampling/sampling.py:97: FutureWarning: In v4.0, pm.sample will return an `arviz.InferenceData` object instead of a `MultiTrace` by default. You can pass return_inferencedata=True or return_inferencedata=False to be safe and silence this warning.
  return pm.sample(draws=draws, tune=tune, model=model, step=step, **kwargs)
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [funcert, dvr0, phi0_vec, A, P, K, taugran, Agran, fmax, Qosc, Aosc]
</pre></div>
</div>
<div class="output text_html">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='4000' class='' max='4000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [4000/4000 01:57<00:00 Sampling 2 chains, 62 divergences]
</div>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 2 chains for 1_000 tune and 1_000 draw iterations (2_000 + 2_000 draws total) took 140 seconds.
There were 24 divergences after tuning. Increase `target_accept` or reparameterize.
There were 38 divergences after tuning. Increase `target_accept` or reparameterize.
The number of effective samples is smaller than 25% for some parameters.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">aldeb_model</span><span class="p">:</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">aldeb_trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;dvr0&#39;</span><span class="p">,</span> <span class="s1">&#39;Aosc&#39;</span><span class="p">,</span> <span class="s1">&#39;Qosc&#39;</span><span class="p">,</span> <span class="s1">&#39;fmax&#39;</span><span class="p">,</span> <span class="s1">&#39;Agran&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="s1">&#39;funcert&#39;</span><span class="p">])</span>
<span class="n">summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>P</th>
      <td>628.754</td>
      <td>1.883</td>
      <td>625.329</td>
      <td>632.269</td>
      <td>0.057</td>
      <td>0.040</td>
      <td>1111.0</td>
      <td>967.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>dvr0[0]</th>
      <td>-0.059</td>
      <td>0.161</td>
      <td>-0.353</td>
      <td>0.243</td>
      <td>0.005</td>
      <td>0.004</td>
      <td>1240.0</td>
      <td>754.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>dvr0[1]</th>
      <td>-0.066</td>
      <td>0.123</td>
      <td>-0.291</td>
      <td>0.174</td>
      <td>0.003</td>
      <td>0.003</td>
      <td>1305.0</td>
      <td>870.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>dvr0[2]</th>
      <td>-0.029</td>
      <td>0.251</td>
      <td>-0.536</td>
      <td>0.440</td>
      <td>0.007</td>
      <td>0.006</td>
      <td>1401.0</td>
      <td>985.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>dvr0[3]</th>
      <td>-0.030</td>
      <td>0.156</td>
      <td>-0.326</td>
      <td>0.245</td>
      <td>0.005</td>
      <td>0.004</td>
      <td>1056.0</td>
      <td>680.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>dvr0[4]</th>
      <td>-0.860</td>
      <td>0.665</td>
      <td>-2.078</td>
      <td>0.406</td>
      <td>0.019</td>
      <td>0.013</td>
      <td>1299.0</td>
      <td>959.0</td>
      <td>1.01</td>
    </tr>
    <tr>
      <th>dvr0[5]</th>
      <td>-0.065</td>
      <td>0.148</td>
      <td>-0.340</td>
      <td>0.215</td>
      <td>0.004</td>
      <td>0.004</td>
      <td>1337.0</td>
      <td>737.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>dvr0[6]</th>
      <td>0.471</td>
      <td>0.200</td>
      <td>0.088</td>
      <td>0.825</td>
      <td>0.006</td>
      <td>0.005</td>
      <td>1053.0</td>
      <td>680.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>dvr0[7]</th>
      <td>-0.121</td>
      <td>0.230</td>
      <td>-0.525</td>
      <td>0.326</td>
      <td>0.006</td>
      <td>0.005</td>
      <td>1330.0</td>
      <td>739.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>Aosc</th>
      <td>56.166</td>
      <td>2.877</td>
      <td>50.887</td>
      <td>61.653</td>
      <td>0.079</td>
      <td>0.056</td>
      <td>1298.0</td>
      <td>970.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>Qosc</th>
      <td>2.970</td>
      <td>0.578</td>
      <td>1.882</td>
      <td>3.984</td>
      <td>0.015</td>
      <td>0.011</td>
      <td>1363.0</td>
      <td>1020.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>fmax</th>
      <td>2.272</td>
      <td>0.082</td>
      <td>2.123</td>
      <td>2.426</td>
      <td>0.002</td>
      <td>0.002</td>
      <td>1195.0</td>
      <td>1184.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>Agran</th>
      <td>73.348</td>
      <td>9.298</td>
      <td>57.518</td>
      <td>90.331</td>
      <td>0.282</td>
      <td>0.206</td>
      <td>1212.0</td>
      <td>1117.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>K</th>
      <td>125.074</td>
      <td>13.101</td>
      <td>98.087</td>
      <td>147.738</td>
      <td>0.407</td>
      <td>0.288</td>
      <td>1033.0</td>
      <td>1232.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>e</th>
      <td>0.166</td>
      <td>0.070</td>
      <td>0.036</td>
      <td>0.292</td>
      <td>0.002</td>
      <td>0.002</td>
      <td>1201.0</td>
      <td>803.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>omega</th>
      <td>-1.367</td>
      <td>0.849</td>
      <td>-2.919</td>
      <td>-0.200</td>
      <td>0.028</td>
      <td>0.023</td>
      <td>742.0</td>
      <td>627.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>t0</th>
      <td>146.445</td>
      <td>27.314</td>
      <td>96.073</td>
      <td>200.094</td>
      <td>1.121</td>
      <td>0.825</td>
      <td>608.0</td>
      <td>565.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>funcert[0]</th>
      <td>1.760</td>
      <td>1.084</td>
      <td>0.326</td>
      <td>3.936</td>
      <td>0.031</td>
      <td>0.022</td>
      <td>959.0</td>
      <td>1113.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>funcert[1]</th>
      <td>0.911</td>
      <td>0.654</td>
      <td>0.002</td>
      <td>2.047</td>
      <td>0.020</td>
      <td>0.014</td>
      <td>811.0</td>
      <td>804.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>funcert[2]</th>
      <td>0.821</td>
      <td>0.881</td>
      <td>0.002</td>
      <td>2.540</td>
      <td>0.023</td>
      <td>0.016</td>
      <td>1129.0</td>
      <td>1048.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>funcert[3]</th>
      <td>0.031</td>
      <td>0.025</td>
      <td>0.000</td>
      <td>0.074</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>957.0</td>
      <td>735.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>funcert[4]</th>
      <td>0.644</td>
      <td>0.032</td>
      <td>0.587</td>
      <td>0.706</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>1283.0</td>
      <td>1029.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>funcert[5]</th>
      <td>1.793</td>
      <td>1.602</td>
      <td>0.003</td>
      <td>4.885</td>
      <td>0.057</td>
      <td>0.040</td>
      <td>554.0</td>
      <td>185.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>funcert[6]</th>
      <td>0.020</td>
      <td>0.015</td>
      <td>0.000</td>
      <td>0.047</td>
      <td>0.001</td>
      <td>0.000</td>
      <td>1054.0</td>
      <td>469.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>funcert[7]</th>
      <td>1.140</td>
      <td>0.774</td>
      <td>0.004</td>
      <td>2.393</td>
      <td>0.034</td>
      <td>0.024</td>
      <td>417.0</td>
      <td>364.0</td>
      <td>1.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Here is the traceplot; the model seems to have a lot of “divergences” (places where the ball rolling around the bowl has somehow shot off to “infinity” because it hit a bump or the sampler otherwise failed to accurately integrate the trajectory).  These seem (?) to be associated to small <code class="docutils literal notranslate"><span class="pre">funcert</span></code> (for site 3 and site 6, which are the McDonald 2.7m and 2.1m, the measurement uncertainty scaling factors are <span class="math notranslate nohighlight">\(\lesssim 0.1\)</span>, indicating something very strange about those measurements—they are “too good?”)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">aldeb_model</span><span class="p">:</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">aldeb_trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;dvr0&#39;</span><span class="p">,</span> <span class="s1">&#39;Aosc&#39;</span><span class="p">,</span> <span class="s1">&#39;Qosc&#39;</span><span class="p">,</span> <span class="s1">&#39;fmax&#39;</span><span class="p">,</span> <span class="s1">&#39;Agran&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="s1">&#39;funcert&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/colored_noise_81_0.svg" src="_images/colored_noise_81_0.svg" /></div>
</div>
<p>Normally we would make a residual plot to consider whether the model has correctly “whitened” the residuals.  But for performance reasons, we have only output the <em>mean</em> GP prediction for the stellar RV timeseries, which is not the same thing as a fair draw from the GP—it will be more “centrally concentrated,” so the residuals will look <em>too good</em>.  Instead, we will show the mean of the means GP (whew!) and the mean Keplerian signal below.  Note the “regression to the mean” of the GP between observations—without observations to inform the state space model, the GP mean decays away to zero:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">ts_pred</span><span class="p">,</span> <span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;v_r_kepler_pred&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Keplerian&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">ts_pred</span><span class="p">,</span> <span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;v_r_stellar_pred_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stellar GP Mean&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t - t_\mathrm</span><span class="si">{ref}</span><span class="s1">$ ($\mathrm</span><span class="si">{BJD}</span><span class="s1">$)&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$v_r$ ($\mathrm</span><span class="si">{m}</span><span class="s1"> \, \mathrm</span><span class="si">{s}</span><span class="s1">^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x14fc75a60&gt;
</pre></div>
</div>
<img alt="_images/colored_noise_83_1.svg" src="_images/colored_noise_83_1.svg" /></div>
</div>
<p>Here we plot the Keplerian plus the GP mean against the data for one random draw from the chain (remember—the GP mean will pass “too close” to the data compared to a fair draw from the GP).  Every time this cell is executed a different curve will appear.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Nt</span> <span class="o">=</span> <span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;funcert&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Ns</span> <span class="o">=</span> <span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;funcert&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">with</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;husl&#39;</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="n">Ns</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="n">Nt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">df</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">fu</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dataframes</span><span class="p">,</span> <span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;vr0&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,:],</span> <span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;funcert&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,:]):</span>
        <span class="n">errorbar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">tmid</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rv&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">v0</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rv_uncert&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">fu</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">ts_pred</span><span class="p">,</span> <span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;v_r_stellar_pred_mean&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;v_r_kepler_pred&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t - t_\mathrm</span><span class="si">{med}</span><span class="s1">$ ($\mathrm</span><span class="si">{BDJ}</span><span class="s1">$)&#39;</span><span class="p">)</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$v_r$ ($\mathrm</span><span class="si">{m}</span><span class="s1"> \, \mathrm</span><span class="si">{s}</span><span class="s1">^{-1}$)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/colored_noise_85_0.svg" src="_images/colored_noise_85_0.svg" /></div>
</div>
<p>Here is the PSD of the stellar GP, clearly showing a peak around <span class="math notranslate nohighlight">\(2 \, \mu\mathrm{Hz}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">fs</span><span class="o">*</span><span class="n">median</span><span class="p">(</span><span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">fill_between</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">fs</span><span class="o">*</span><span class="n">quantile</span><span class="p">(</span><span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">],</span> <span class="mf">0.84</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">fs</span><span class="o">*</span><span class="n">quantile</span><span class="p">(</span><span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">],</span> <span class="mf">0.16</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">l</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">fill_between</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">fs</span><span class="o">*</span><span class="n">quantile</span><span class="p">(</span><span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">],</span> <span class="mf">0.975</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">fs</span><span class="o">*</span><span class="n">quantile</span><span class="p">(</span><span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">],</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">l</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f$ ($\mu\mathrm</span><span class="si">{Hz}</span><span class="s1">$)&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f P(f)$ ($\mathrm</span><span class="si">{m}</span><span class="s1">^2 \, \mathrm</span><span class="si">{s}</span><span class="s1">^{-2}$)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$f P(f)$ ($\\mathrm{m}^2 \\, \\mathrm{s}^{-2}$)&#39;)
</pre></div>
</div>
<img alt="_images/colored_noise_87_1.svg" src="_images/colored_noise_87_1.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">271</span><span class="o">-</span><span class="mi">207</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>64
</pre></div>
</div>
</div>
</div>
<p>And the inferred peak value: <span class="math notranslate nohighlight">\(\nu_\mathrm{max} = 2.28^{+0.102}_{-0.064} \, \mu\mathrm{Hz}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">aldeb_model</span><span class="p">:</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">aldeb_trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="s1">&#39;fmax&#39;</span><span class="p">,</span> <span class="n">point_estimate</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">0.68</span><span class="p">)</span>
    <span class="n">title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\nu_\mathrm</span><span class="si">{max}</span><span class="s1">$ ($\mu\mathrm</span><span class="si">{Hz}</span><span class="s1">$)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/colored_noise_90_0.svg" src="_images/colored_noise_90_0.svg" /></div>
</div>
<p>Something very strange is going on with the errorbars in the McDonald instrument—our model would prefer then to be something like 1% of the quoted uncertainty….  We also see that the Song telescope appears to be a bit pessisimistic about its uncertainty (inflated by ~30% relative to what the model would prefer).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;husl&#39;</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">fnames</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fnames</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">dsnames</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">aldeb_trace</span><span class="p">[</span><span class="s1">&#39;funcert&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">],</span> <span class="n">log_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f_\mathrm</span><span class="si">{uncert}</span><span class="s1">$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/colored_noise_92_0.svg" src="_images/colored_noise_92_0.svg" /></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="regression_and_curve_fitting.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Regression and Curve Fitting</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="populations.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Populations and Catalogs</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Will M. Farr<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>