
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>An Example to Set the Stage &#8212; Astrostatistics</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="PHY 688: Computational Astrophysics Syllabus" href="syllabus.html" />
    <link rel="prev" title="PHY 688: Numerical Methods in Astrophysics." href="intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Astrostatistics</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   PHY 688: Numerical Methods in Astrophysics.
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   An Example to Set the Stage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="syllabus.html">
   PHY 688: Computational Astrophysics Syllabus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="regression_and_curve_fitting.html">
   Regression and Curve Fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="colored_noise.html">
   Colored Noise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gaussian_processes.html">
   Gaussian Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="populations.html">
   Populations and Catalogs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="selection_effects.html">
   Selection Effects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="special_methods.html">
   Special Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tips_and_tricks.html">
   Tips and Tricks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="project_ideas.html">
   Project Ideas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/welcome.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/farr/Astrostatistics"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/farr/Astrostatistics/issues/new?title=Issue%20on%20page%20%2Fwelcome.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/farr/Astrostatistics/main?urlpath=tree/astrostatistics/welcome.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#it-was-a-dark-and-stormy-night">
   It Was a Dark and Stormy Night…
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-extensions-and-checking">
   Model Extensions and Checking
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#if-that-was-model-expansion-let-s-try-model-explosion">
   If That Was Model “Expansion,” Let’s Try Model “Explosion”
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="an-example-to-set-the-stage">
<h1>An Example to Set the Stage<a class="headerlink" href="#an-example-to-set-the-stage" title="Permalink to this headline">¶</a></h1>
<p>Before we start, here are some boring preliminaries to load the code to execute this notebook into your environment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Pkg</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">joinpath</span><span class="p">(</span><span class="nd">@__DIR__</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Green">  Activating</span> environment at `~/Teaching/astrostatistics/Project.toml`
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Astrostatistics688</span> <span class="c"># Loads some code specific to this course with utility functions, etc</span>
<span class="k">using</span> <span class="n">DataFrames</span>
<span class="k">using</span> <span class="n">LaTeXStrings</span>
<span class="k">using</span> <span class="n">Logging</span>
<span class="k">using</span> <span class="n">Printf</span>
<span class="k">using</span> <span class="n">StatsBase</span>
<span class="k">using</span> <span class="n">StatsPlots</span>
<span class="k">using</span> <span class="n">Turing</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>┌ Info: Precompiling Astrostatistics688 [085d2733-bd12-45d8-916e-6d1689ffe6cb]
└ @ Base loading.jl:1342
┌ Info: Precompiling StatsPlots [f3b207a7-027a-5e70-b257-86293d7955fd]
└ @ Base loading.jl:1342
┌ Info: Precompiling Turing [fce5fe82-541a-59a6-adf8-730c64b5f9a0]
└ @ Base loading.jl:1342
</pre></div>
</div>
</div>
</div>
<div class="section" id="it-was-a-dark-and-stormy-night">
<h2>It Was a Dark and Stormy Night…<a class="headerlink" href="#it-was-a-dark-and-stormy-night" title="Permalink to this headline">¶</a></h2>
<p>…in the middle of the COVID 19 pandemic.  You are facing an unpleasant task (writing a grant proposal, cleaning the kitchen, etc) when your colleague <a class="reference external" href="https://scholar.google.com/citations?user=IrkY3dQAAAAJ&amp;hl=en">Jeff Kissell</a> emails you, asking for advice with the analysis of some measurements.  Jeff and his collaborators have been pushing on the LIGO mirrors gravitationally, using a rotating massive disk; they measure the response of the interferometer to the forcing at different frequencies, and can then calibrate the relation between mirror displacement (computed from the gravitational force law) and interferometer output.  Such calibration allows for accurate measurements of gravitational wave amplitudes.</p>
<p>The project eventually grew into <span id="id1">[<a class="reference internal" href="bibliography.html#id2">Ross <em>et al.</em>, 2021</a>]</span>.  The data we have here are very preliminary versions of the data that can be found in that paper.</p>
<p>One feature of the measurements of interferometer response here is that the uncertainty in the measurement is <em>asymmetric</em>.  The data below give the “upper” and “lower” 1-sigma values (together these enclose 68% of the confidence interval of the measurement).  For now, we are going to ignore this, so we will construct a column called <code class="docutils literal notranslate"><span class="pre">:sigma</span></code> that averages the upper and lower uncertainties.</p>
<p>There are two sets of measurements: one taken at the forcing frequencies of the rotor mass’s quadrupole mass moment and one taken at the forcing frequencies of the rotor mass’s octupole mass moment.  There are consistent units on the response and associated uncertainty, but we will ignore them for now; see <span id="id2">[<a class="reference internal" href="bibliography.html#id2">Ross <em>et al.</em>, 2021</a>]</span> for the details.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">quad_data</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">([</span><span class="mf">10.300</span> <span class="mf">3.328e-11</span> <span class="mf">1.706e-12</span> <span class="mf">1.476e-12</span><span class="p">;</span>
                       <span class="mf">15.600</span> <span class="mf">3.442e-11</span> <span class="mf">1.027e-12</span> <span class="mf">1.023e-12</span><span class="p">;</span>
                       <span class="mf">17.100</span> <span class="mf">3.379e-11</span> <span class="mf">9.777e-13</span> <span class="mf">1.015e-12</span><span class="p">;</span>
                       <span class="mf">19.112</span> <span class="mf">3.376e-11</span> <span class="mf">9.033e-13</span> <span class="mf">9.972e-13</span><span class="p">],</span>
                      <span class="p">[</span><span class="ss">:freq</span><span class="p">,</span> <span class="ss">:response</span><span class="p">,</span> <span class="ss">:sigma_upper</span><span class="p">,</span> <span class="ss">:sigma_lower</span><span class="p">])</span>
<span class="n">insertcols!</span><span class="p">(</span><span class="n">quad_data</span><span class="p">,</span> <span class="ss">:sigma</span> <span class="o">=&gt;</span> <span class="mf">0.5</span> <span class="o">.*</span> <span class="p">(</span><span class="n">quad_data</span><span class="o">.</span><span class="n">sigma_upper</span> <span class="o">.+</span> <span class="n">quad_data</span><span class="o">.</span><span class="n">sigma_lower</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class="data-frame"><p>4 rows × 5 columns</p><table class="data-frame"><thead><tr><th></th><th>freq</th><th>response</th><th>sigma_upper</th><th>sigma_lower</th><th>sigma</th></tr><tr><th></th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Float64">Float64</th></tr></thead><tbody><tr><th>1</th><td>10.3</td><td>3.328e-11</td><td>1.706e-12</td><td>1.476e-12</td><td>1.591e-12</td></tr><tr><th>2</th><td>15.6</td><td>3.442e-11</td><td>1.027e-12</td><td>1.023e-12</td><td>1.025e-12</td></tr><tr><th>3</th><td>17.1</td><td>3.379e-11</td><td>9.777e-13</td><td>1.015e-12</td><td>9.9635e-13</td></tr><tr><th>4</th><td>19.112</td><td>3.376e-11</td><td>9.033e-13</td><td>9.972e-13</td><td>9.5025e-13</td></tr></tbody></table></div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> can output summary statistics on the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">describe</span><span class="p">(</span><span class="n">quad_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class="data-frame"><p>5 rows × 7 columns</p><table class="data-frame"><thead><tr><th></th><th>variable</th><th>mean</th><th>min</th><th>median</th><th>max</th><th>nmissing</th><th>eltype</th></tr><tr><th></th><th title="Symbol">Symbol</th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Int64">Int64</th><th title="DataType">DataType</th></tr></thead><tbody><tr><th>1</th><td>freq</td><td>15.528</td><td>10.3</td><td>16.35</td><td>19.112</td><td>0</td><td>Float64</td></tr><tr><th>2</th><td>response</td><td>3.38125e-11</td><td>3.328e-11</td><td>3.3775e-11</td><td>3.442e-11</td><td>0</td><td>Float64</td></tr><tr><th>3</th><td>sigma_upper</td><td>1.1535e-12</td><td>9.033e-13</td><td>1.00235e-12</td><td>1.706e-12</td><td>0</td><td>Float64</td></tr><tr><th>4</th><td>sigma_lower</td><td>1.1278e-12</td><td>9.972e-13</td><td>1.019e-12</td><td>1.476e-12</td><td>0</td><td>Float64</td></tr><tr><th>5</th><td>sigma</td><td>1.14065e-12</td><td>9.5025e-13</td><td>1.01067e-12</td><td>1.591e-12</td><td>0</td><td>Float64</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">oct_data</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">([</span><span class="mf">12.500</span> <span class="mf">1.619e-11</span> <span class="mf">5.142e-13</span> <span class="mf">5.172e-13</span><span class="p">;</span>
                      <span class="mf">15.500</span> <span class="mf">1.516e-11</span> <span class="mf">4.521e-13</span> <span class="mf">4.506e-13</span><span class="p">;</span>
                      <span class="mf">23.400</span> <span class="mf">1.647e-11</span> <span class="mf">3.830e-13</span> <span class="mf">4.080e-13</span><span class="p">;</span>
                      <span class="mf">25.700</span> <span class="mf">1.516e-11</span> <span class="mf">3.047e-13</span> <span class="mf">3.286e-13</span><span class="p">;</span>
                      <span class="mf">28.700</span> <span class="mf">1.556e-11</span> <span class="mf">2.839e-13</span> <span class="mf">2.912e-13</span><span class="p">],</span>
                     <span class="p">[</span><span class="ss">:freq</span><span class="p">,</span> <span class="ss">:response</span><span class="p">,</span> <span class="ss">:sigma_upper</span><span class="p">,</span> <span class="ss">:sigma_lower</span><span class="p">])</span>
<span class="n">insertcols!</span><span class="p">(</span><span class="n">oct_data</span><span class="p">,</span> <span class="ss">:sigma</span> <span class="o">=&gt;</span> <span class="mf">0.5</span> <span class="o">.*</span> <span class="p">(</span><span class="n">oct_data</span><span class="o">.</span><span class="n">sigma_upper</span> <span class="o">.+</span> <span class="n">oct_data</span><span class="o">.</span><span class="n">sigma_lower</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class="data-frame"><p>5 rows × 5 columns</p><table class="data-frame"><thead><tr><th></th><th>freq</th><th>response</th><th>sigma_upper</th><th>sigma_lower</th><th>sigma</th></tr><tr><th></th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Float64">Float64</th></tr></thead><tbody><tr><th>1</th><td>12.5</td><td>1.619e-11</td><td>5.142e-13</td><td>5.172e-13</td><td>5.157e-13</td></tr><tr><th>2</th><td>15.5</td><td>1.516e-11</td><td>4.521e-13</td><td>4.506e-13</td><td>4.5135e-13</td></tr><tr><th>3</th><td>23.4</td><td>1.647e-11</td><td>3.83e-13</td><td>4.08e-13</td><td>3.955e-13</td></tr><tr><th>4</th><td>25.7</td><td>1.516e-11</td><td>3.047e-13</td><td>3.286e-13</td><td>3.1665e-13</td></tr><tr><th>5</th><td>28.7</td><td>1.556e-11</td><td>2.839e-13</td><td>2.912e-13</td><td>2.8755e-13</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">describe</span><span class="p">(</span><span class="n">oct_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class="data-frame"><p>5 rows × 7 columns</p><table class="data-frame"><thead><tr><th></th><th>variable</th><th>mean</th><th>min</th><th>median</th><th>max</th><th>nmissing</th><th>eltype</th></tr><tr><th></th><th title="Symbol">Symbol</th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Float64">Float64</th><th title="Int64">Int64</th><th title="DataType">DataType</th></tr></thead><tbody><tr><th>1</th><td>freq</td><td>21.16</td><td>12.5</td><td>23.4</td><td>28.7</td><td>0</td><td>Float64</td></tr><tr><th>2</th><td>response</td><td>1.5708e-11</td><td>1.516e-11</td><td>1.556e-11</td><td>1.647e-11</td><td>0</td><td>Float64</td></tr><tr><th>3</th><td>sigma_upper</td><td>3.8758e-13</td><td>2.839e-13</td><td>3.83e-13</td><td>5.142e-13</td><td>0</td><td>Float64</td></tr><tr><th>4</th><td>sigma_lower</td><td>3.9912e-13</td><td>2.912e-13</td><td>4.08e-13</td><td>5.172e-13</td><td>0</td><td>Float64</td></tr><tr><th>5</th><td>sigma</td><td>3.9335e-13</td><td>2.8755e-13</td><td>3.955e-13</td><td>5.157e-13</td><td>0</td><td>Float64</td></tr></tbody></table></div></div></div>
</div>
<p>Let’s make a plot of the data, and see what it “looks like:”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">plot_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">label</span><span class="p">;</span> <span class="n">kwargs</span><span class="o">...</span><span class="p">)</span>
    <span class="n">scatter!</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">response</span><span class="p">;</span> <span class="n">yerr</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sigma_lower</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">sigma_upper</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">...</span><span class="p">)</span>
    <span class="n">xlabel!</span><span class="p">(</span><span class="sa">L</span><span class="s">&quot;f / \mathrm{Hz}&quot;</span><span class="p">)</span>
    <span class="n">ylabel!</span><span class="p">(</span><span class="s">&quot;Response (arb. units)&quot;</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">plot</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">quad_data</span><span class="p">,</span> <span class="s">&quot;Quadrupole&quot;</span><span class="p">)</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">oct_data</span><span class="p">,</span> <span class="s">&quot;Octupole&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/welcome_12_0.svg" src="_images/welcome_12_0.svg" /></div>
</div>
<p>Looking at the above plot, it certainly seems reasonable enough to ignore the asymmetry in the measurement uncertainty.  It also seems reasonable that there is one “quadrupole” and one “octupole” forcing response at all frequencies (i.e. that the measurements are all “consistent”—we will spend a long time discussing what that means in this course!—with each other).  You may remember formulas from your physics labs for combining such measurements.</p>
<p>If you don’t, here they are: for a set of measurements <span class="math notranslate nohighlight">\(\{x_i \mid i = 1, \ldots, N \}\)</span> with associated uncertainty <span class="math notranslate nohighlight">\(\{\sigma_i \mid i = 1, \ldots, N\}\)</span> (here each <span class="math notranslate nohighlight">\(\sigma_i\)</span> is assumed to be the square root of the measurement variance) of the same “true” quantity <span class="math notranslate nohighlight">\(x\)</span>, the “best” estimate of <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(\hat{x}\)</span> is</p>
<div class="math notranslate nohighlight" id="equation-weighted-mean">
<span class="eqno">(1)<a class="headerlink" href="#equation-weighted-mean" title="Permalink to this equation">¶</a></span>\[
  \hat{x} = \frac{\sum_i w_i x_i}{\sum_i w_i},
\]</div>
<p>and the variance of the estimator is</p>
<div class="math notranslate nohighlight" id="equation-variance-weighted-mean">
<span class="eqno">(2)<a class="headerlink" href="#equation-variance-weighted-mean" title="Permalink to this equation">¶</a></span>\[
\DeclareMathOperator{\var}{var}
\var \hat{x} = \left( \sum_i w_i \right)^{-1}
\]</div>
<p>where</p>
<div class="math notranslate nohighlight" id="equation-weighted-mean-weights">
<span class="eqno">(3)<a class="headerlink" href="#equation-weighted-mean-weights" title="Permalink to this equation">¶</a></span>\[
w_i = \frac{1}{\sigma_i^2}
\]</div>
<p>This function implements these formulas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">mean_response_and_uncertainty</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">sigmas</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sigma_upper</span> <span class="o">.+</span> <span class="n">df</span><span class="o">.</span><span class="n">sigma_lower</span><span class="p">)</span> <span class="o">./</span> <span class="mi">2</span>
    <span class="n">wts</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">./</span> <span class="p">(</span><span class="n">sigmas</span><span class="o">.*</span><span class="n">sigmas</span><span class="p">)</span>
    <span class="n">mr</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">response</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">wts</span><span class="p">)</span> <span class="o">/</span> <span class="n">sum</span><span class="p">(</span><span class="n">wts</span><span class="p">)</span>
    <span class="n">mr_uncert</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sum</span><span class="p">(</span><span class="n">wts</span><span class="p">))</span>
    <span class="p">(</span><span class="n">mr</span><span class="p">,</span> <span class="n">mr_uncert</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mean_response_and_uncertainty (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<p>and applying them to our data sets yields:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="n">qr</span><span class="p">,</span> <span class="n">qs</span><span class="p">),</span> <span class="p">(</span><span class="n">or</span><span class="p">,</span> <span class="n">os</span><span class="p">))</span> <span class="o">=</span> <span class="n">mean_response_and_uncertainty</span><span class="p">(</span><span class="n">quad_data</span><span class="p">),</span> <span class="n">mean_response_and_uncertainty</span><span class="p">(</span><span class="n">oct_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((3.3895423514377936e-11, 5.374742788398296e-13), (1.5620160113070848e-11, 1.6411225320059946e-13))
</pre></div>
</div>
</div>
</div>
<p>Or, graphically:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">plot_bands</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">;</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">...</span><span class="p">)</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">xlims</span><span class="p">()</span>
    <span class="n">plot!</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">],</span> <span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
    <span class="n">plot!</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">],</span> <span class="p">[</span><span class="n">r</span><span class="o">+</span><span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="o">+</span><span class="n">s</span><span class="p">];</span> <span class="n">fillrange</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="o">-</span><span class="n">s</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">...</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">plot</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">quad_data</span><span class="p">,</span> <span class="s">&quot;Quadrupole&quot;</span><span class="p">)</span>
<span class="n">plot_bands</span><span class="p">(</span><span class="n">qr</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/welcome_25_0.svg" src="_images/welcome_25_0.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">oct_data</span><span class="p">,</span> <span class="s">&quot;Octupole&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plot_bands</span><span class="p">(</span><span class="n">or</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/welcome_26_0.svg" src="_images/welcome_26_0.svg" /></div>
</div>
<p>But where do these formulas come from?  What are the assumptions behind them?</p>
<p>If we imagine that:</p>
<ul class="simple">
<li><p>There is a single, true, response value <span class="math notranslate nohighlight">\(r\)</span>.</p></li>
<li><p>Each measurement of this value suffers from independent “noise” which induces a Gaussian-distributed measured value, <span class="math notranslate nohighlight">\(x_i\)</span>, that is unbaised (mean <span class="math notranslate nohighlight">\(r\)</span>) and s.d. <span class="math notranslate nohighlight">\(\sigma_i\)</span>.</p></li>
</ul>
<p>then we can write down the “joint probability distribution” over the unknown <span class="math notranslate nohighlight">\(r\)</span> and any measurement values that is</p>
<div class="math notranslate nohighlight" id="equation-joint-gaussian-bayes">
<span class="eqno">(4)<a class="headerlink" href="#equation-joint-gaussian-bayes" title="Permalink to this equation">¶</a></span>\[
  \pi \left( \left\{ x_i \right\} , r \right) = p\left( \left\{ x_i \right\} \mid r \right) p\left( r \right)
\]</div>
<p>(This is Bayes theorem about factoring a joint probability into a product of a conditional and marginal probability.  Here <span class="math notranslate nohighlight">\(p\left( \left\{ x_i \right\} \mid r \right)\)</span> is the <em>conditional</em> probability of making the <span class="math notranslate nohighlight">\(x_i\)</span> measurements given a particular value of <span class="math notranslate nohighlight">\(r\)</span>, sometimes called the “likelihood” function for <span class="math notranslate nohighlight">\(r\)</span>; <span class="math notranslate nohighlight">\(p(r)\)</span> is a distribution that reflects our beliefs about the reasonable values of <span class="math notranslate nohighlight">\(r\)</span> before the measurement or the possible population of <span class="math notranslate nohighlight">\(r\)</span> values over all experiments, sometimes called the “prior.”)</p>
<p>The first term in <a class="reference internal" href="#equation-joint-gaussian-bayes">(4)</a> becomes a product (independence assumption) of Gaussians (Gaussian-distributed assumption):</p>
<div class="math notranslate nohighlight" id="equation-gaussian-likelihood">
<span class="eqno">(5)<a class="headerlink" href="#equation-gaussian-likelihood" title="Permalink to this equation">¶</a></span>\[
p\left( \left\{ x_i \right\} \mid r \right) = \prod_i \frac{1}{\sqrt{2\pi \sigma_i^2}} \exp\left( - \frac{\left( x_i - r \right)^2}{2 \sigma_i^2} \right)
\]</div>
<p>We can use Bayes’ theorem to “slice” the joint distribution the “other” way:</p>
<div class="math notranslate nohighlight" id="equation-gaussian-posterior">
<span class="eqno">(6)<a class="headerlink" href="#equation-gaussian-posterior" title="Permalink to this equation">¶</a></span>\[
\pi \left(\left\{ x_i \right\}, r \right) = p\left( r \mid \left\{ x_i \right\} \right) p\left( \left\{ x_i \right\} \right)
\]</div>
<p>Once we have the measurement data <span class="math notranslate nohighlight">\(\left\{ x_i \right\}\)</span>, this form gives us (up to an annoying constant, <span class="math notranslate nohighlight">\(p\left( \left\{ x_i \right\} \right)\)</span>, that we will spend some time on later in the course) a “posterior” distribution over <span class="math notranslate nohighlight">\(r\)</span> reflecting our knowledge of <span class="math notranslate nohighlight">\(r\)</span> given the measurements we have made.  Equating Eq. <a class="reference internal" href="#equation-joint-gaussian-bayes">(4)</a> and Eq. <a class="reference internal" href="#equation-gaussian-posterior">(6)</a>, and using the form of the likelihood in Eq. <a class="reference internal" href="#equation-gaussian-likelihood">(5)</a>, and assuming that whatever distribution we use for <span class="math notranslate nohighlight">\(p(r)\)</span> will be much broader than the product of the likelihood functions (this is equivalent to saying that our measurement is <em>informative</em>) we have</p>
<div class="math notranslate nohighlight" id="equation-posterior-weights">
<span class="eqno">(7)<a class="headerlink" href="#equation-posterior-weights" title="Permalink to this equation">¶</a></span>\[
p\left( r \mid \left\{ x_i \right\} \right) \propto \exp\left( -\frac{\left( r - \mu_r \right)^2}{2 \sigma_r^2} \right),
\]</div>
<p>where (check the algebra!)</p>
<div class="math notranslate nohighlight" id="equation-weighted-mean-posterior-mean">
<span class="eqno">(8)<a class="headerlink" href="#equation-weighted-mean-posterior-mean" title="Permalink to this equation">¶</a></span>\[
\mu_r = \hat{r} = \frac{\sum_i w_i x_i}{\sum_i w_i}
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\sigma_r^2 = \left( \sum_i w_i \right)^{-1}
\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[
w_i = \frac{1}{\sigma_i^2}.
\]</div>
<p>So, we see that the “standard” formulas for combining uncertain measurements correspond to computing the mean and s.d. of the posterior distribution on the single, true value <span class="math notranslate nohighlight">\(r\)</span> given the measurements.</p>
</div>
<div class="section" id="model-extensions-and-checking">
<h2>Model Extensions and Checking<a class="headerlink" href="#model-extensions-and-checking" title="Permalink to this headline">¶</a></h2>
<p>A striking feature of the plots above is that it seems that the uncertainty reported with the measurements is not a good match to the actual scatter about the inferred value of <span class="math notranslate nohighlight">\(r\)</span>.  In the quadrupolar measurements, the measured responses are “too close” to the truth relative to their errorbars; and the measured responses for the octupolar measurements seem like they could be too far from the truth.</p>
<p>One reasonable extension to the model above could be to introduce a “fudge factor” or “scale factor” that re-scales the reported uncertainties to match the scatter in the data.  This model would trust the <em>relative</em> but not <em>absolute</em> errorbar sizes; such a fudge-factor is commonly used in photometry, for example.  We will denote the scale factor by <span class="math notranslate nohighlight">\(\nu\)</span>.</p>
<p>The likelihood function in this case would be modified to</p>
<div class="math notranslate nohighlight" id="equation-gaussian-likelihood-errorbar-scaling">
<span class="eqno">(9)<a class="headerlink" href="#equation-gaussian-likelihood-errorbar-scaling" title="Permalink to this equation">¶</a></span>\[
p\left( \left\{ x_i \right\} \mid r, \nu \right) = \prod_i \frac{1}{\sqrt{2\pi \nu^2 \sigma_i^2}} \exp\left( - \frac{\left( x_i - r \right)^2}{2 \nu^2 \sigma_i^2} \right)
\]</div>
<p>We will use the <a class="reference external" href="https://turing.ml/stable/"><code class="docutils literal notranslate"><span class="pre">Turing.jl</span></code></a> <span id="id3">[<a class="reference internal" href="bibliography.html#id5">Tarek <em>et al.</em>, 2020</a>]</span> package to implement this model and to draw samples from the posterior over the true response and scale factor given the data, <span class="math notranslate nohighlight">\(p\left( r, \nu \mid \left\{ x_i \right\} \right)\)</span> (analagous to Eq. <a class="reference internal" href="#equation-gaussian-posterior">(6)</a>, but incorporating our extra parameter).  This is worth elaborating on a bit.  Above, we were considering the <em>function</em> <span class="math notranslate nohighlight">\(p\left( r \mid \left\{ x_i \right\} \right)\)</span> that represented the posterior probability distribution function for <span class="math notranslate nohighlight">\(r\)</span> given our observations.  We found that the <em>function</em> takes a Gaussian form, with a given mean and standard deviation.</p>
<p>In general, however, while we may be able to compute arbitrary <em>values</em> (or, as above, values <em>up to a constant factor</em>) of the posterior density using a computer program, the density won’t have a simple functional form that is useful to us.  It may be high dimensional, too (in this case we have only two parameters, but already the dimension is higher than the simpler model above with one parameter); in high dimensions it is cumbersome to work with the functional form of the posterior even if it is represented by simple functions.  In such cases it can be more convenient to work with <em>samples</em> drawn from the posterior probability distribution.  Such samples can be used to approximate integrals of the posterior: an integral of some function <span class="math notranslate nohighlight">\(f\)</span> over the posterior density <span class="math notranslate nohighlight">\(p\)</span> can be approximated by</p>
<div class="math notranslate nohighlight">
\[
\int \mathrm{d} x f(x) p(x) = \left\langle f(x) \right\rangle_{p} \simeq \frac{1}{N} \sum_j f\left( x_j \right)
\]</div>
<p>where <span class="math notranslate nohighlight">\(N\)</span> is the number of samples <span class="math notranslate nohighlight">\(x_j \sim p(x)\)</span> we have available.  This formula works in any number of dimensions (we will study its error encapsulated in “<span class="math notranslate nohighlight">\(\simeq\)</span>” carefully later in the term).</p>
<p>The fact that samples can stand in for the posterior denisty itself is even more magical than it might appear at first; it has to do with the sorts of questions we like to ask using the posterior.  These tend to be “low dimensional” questions even if the posterior itself is high-dimensional.  Consder, for example, a posterior that is uniform on <code class="docutils literal notranslate"><span class="pre">(-1,</span> <span class="pre">1)</span></code> in 100 dimensions: <span class="math notranslate nohighlight">\(U(-1, 1)^{100}\)</span>.  To even have one sample with each possible sign of each component represented in a set of samples would require <span class="math notranslate nohighlight">\(2^{100} \simeq 10^{30}\)</span> samples!  But even a few tens of samples is sufficient to discover, for example, that <span class="math notranslate nohighlight">\(\left\langle \vec{x} \right\rangle = \vec{0}\)</span> when <span class="math notranslate nohighlight">\(\vec{x} \sim U\left( -1, 1 \right)^{100}\)</span> to quite good accuracy.</p>
<p>There are various algorithms for drawing samples from an arbitrary distribution that we will be discussing in the course; the <code class="docutils literal notranslate"><span class="pre">Turing</span></code> library implements several of them.  Here we will be using “No U-Turn Sampling” <span id="id4">[<a class="reference internal" href="bibliography.html#id3">Hoffman and Gelman, 2011</a>]</span> which is an automatically-tuned variant of the Hamiltonian Monte Carlo MCMC method <span id="id5">[<a class="reference internal" href="bibliography.html#id4">Neal, 2011</a>]</span>.  More on these sorts of algorithms later.</p>
<p>Back to our specific example: the <code class="docutils literal notranslate"><span class="pre">Turing</span></code> library needs from us a description of the joint density on <span class="math notranslate nohighlight">\(\left\{ x_i \right\}\)</span> and <span class="math notranslate nohighlight">\(\left( r, \nu \right)\)</span>, and then the values of the <span class="math notranslate nohighlight">\(x_i\)</span>.  It then can draw samples of <span class="math notranslate nohighlight">\(r\)</span> and <span class="math notranslate nohighlight">\(\nu\)</span> from the conditional posterior density (the <span class="math notranslate nohighlight">\(x_i\)</span> are fixed).</p>
<p>One of the strengths of <code class="docutils literal notranslate"><span class="pre">Turing</span></code> and similar libraries like <code class="docutils literal notranslate"><span class="pre">numpyro</span></code>, <code class="docutils literal notranslate"><span class="pre">pymc3</span></code>, <code class="docutils literal notranslate"><span class="pre">stan</span></code>, …, is that we don’t have to write out the posterior function explicitly (as we have done above, in Eq. <a class="reference internal" href="#equation-gaussian-likelihood-errorbar-scaling">(9)</a>); instead we can specify that certain variables follow certain distributions, and <code class="docutils literal notranslate"><span class="pre">Turing</span></code> will build up the right density for us.  It can even handle constraints like the fact that <span class="math notranslate nohighlight">\(0 &lt; \nu &lt; \infty\)</span> elegantly (it makes no sense for us to scale the quoted uncertainties by a negative number).</p>
<p>Of course, if we <em>do</em> want to write out our functions that go into the posterior distribution explicitly, there is a way to do that, too.  Stay tuned!</p>
<p>The code for the <code class="docutils literal notranslate"><span class="pre">Turing</span></code> implementation of the scaled-errorbar model is in the next cell.  Models are implemented as a <code class="docutils literal notranslate"><span class="pre">&#64;model</span></code> macro (to introduce some extra syntax like the <code class="docutils literal notranslate"><span class="pre">~</span></code> operator: writing <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">~</span> <span class="pre">Y(z)</span></code> means that the variable <code class="docutils literal notranslate"><span class="pre">x</span></code> is distributed according to the distribution <code class="docutils literal notranslate"><span class="pre">Y</span></code> which can have parameters <code class="docutils literal notranslate"><span class="pre">z</span></code>) that closely follows the definition syntax for a function.  The arguments to the “function” are the data and whatever parameters on which the model is conditioned; here the measured responses and their uncertainties.  Within the function, we define distributions for parameters (i.e. priors, see Eq. <a class="reference internal" href="#equation-gaussian-posterior">(6)</a>) and also distributions for data (likelihood functions) that can depend on parameters and other data.  When <code class="docutils literal notranslate"><span class="pre">Turing</span></code> sees a “new” variable in a <code class="docutils literal notranslate"><span class="pre">~</span></code> statement (i.e. a variable that is not a function argument), then it treats it as the definition of a new parameter to be sampled over; when it sees an already-defined variable (i.e. a function argument) in a <code class="docutils literal notranslate"><span class="pre">~</span></code> statement, then it assumes that variable should be <em>conditioned on</em> and assumes the value that is passed to the model constructor when the model is instantiated; see comments in the model below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># The model depends on the measured responses and their uncertainties; these are the quantities &quot;to the right of the bar&quot; above</span>
<span class="nd">@model</span> <span class="k">function</span> <span class="n">scaled_errorbar</span><span class="p">(</span><span class="n">responses</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">)</span>
    <span class="c"># It is inconvenient to work with quantities that are O(1e-11), so we define these &quot;unit-scale&quot; parameters from which the actual parameters are derived.</span>
    <span class="n">r_unit</span> <span class="o">~</span> <span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c"># r_unit follows a Gaussian distribution with mean zero and width 10</span>
    <span class="n">nu</span> <span class="o">~</span> <span class="n">LogNormal</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># the scale factor follows a log-normal distribution with mean (of the log) 0 and s.d. (of the log) 1.</span>
    
    <span class="c"># If r_unit ~ N(0,10), then r ~ N(mean(response), 10*std(response)), which is a broad and uninformative prior for the parameter r</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span> <span class="o">+</span> <span class="n">std</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span><span class="o">*</span><span class="n">r_unit</span>
    
    <span class="c"># The likelihood function: we construct an array of Normal distributions with mean r and standard deviation nu*sigma_i;</span>
    <span class="c"># the array of measurements is assumed drawn from this array of distributions.</span>
    <span class="n">responses</span> <span class="o">~</span> <span class="n">arraydist</span><span class="p">([</span><span class="n">Normal</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">nu</span><span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="k">in</span> <span class="n">sigmas</span><span class="p">])</span>
    
    <span class="c"># Parameters like r_unit and nu will automatically be captured in the fitting of the model; but additional &quot;generated&quot; quantities need to be explicitly </span>
    <span class="c"># returned.  Here `r` is such a &quot;generated&quot; quantity, so we return it in a &quot;named tuple&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>scaled_errorbar (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<p>Now we construct a model instance from the quadrupolar data, draw samples from it using 1000 steps of the NUTS algorithm (again, stay tuned!), generate the quantities like <span class="math notranslate nohighlight">\(r\)</span> that are defined in terms of more basic parameters, and display the MCMC “trace.”  Unfortunately, at this time <code class="docutils literal notranslate"><span class="pre">Turing</span></code> does not treat the “generated” quantities on the same footing as the sampled parameters; so I have written a little utility function in the <code class="docutils literal notranslate"><span class="pre">Astrostatistics688</span></code> library that appends the generated quantities into the trace <em>as if</em> they were sampled parameters: <code class="docutils literal notranslate"><span class="pre">append_generated_quantities</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">scaled_quad_model</span> <span class="o">=</span> <span class="n">scaled_errorbar</span><span class="p">(</span><span class="n">quad_data</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">.*</span> <span class="p">(</span><span class="n">quad_data</span><span class="o">.</span><span class="n">sigma_lower</span> <span class="o">.+</span> <span class="n">quad_data</span><span class="o">.</span><span class="n">sigma_upper</span><span class="p">))</span>
<span class="n">scaled_quad_trace</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">scaled_quad_model</span><span class="p">,</span> <span class="n">NUTS</span><span class="p">(),</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">scaled_quad_genq</span> <span class="o">=</span> <span class="n">with_logger</span><span class="p">(</span><span class="n">NullLogger</span><span class="p">())</span> <span class="k">do</span> <span class="c"># Sometimes this throws a lot of warnings that we don&#39;t care about.</span>
    <span class="n">generated_quantities</span><span class="p">(</span><span class="n">scaled_quad_model</span><span class="p">,</span> <span class="n">scaled_quad_trace</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">scaled_quad_trace</span> <span class="o">=</span> <span class="n">append_generated_quantities</span><span class="p">(</span><span class="n">scaled_quad_trace</span><span class="p">,</span> <span class="n">scaled_quad_genq</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>┌ Info: Found initial step size
│   ϵ = 0.8
└ @ Turing.Inference /Users/wfarr/.julia/packages/Turing/Ysmbf/src/inference/hmc.jl:188
<span class=" -Color -Color-Green">Sampling: 100%|█████████████████████████████████████████| Time: 0:00:00</span>
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Chains MCMC chain (1000×15×1 Array{Float64, 3}):

Iterations        = 1:1:1000
Number of chains  = 1
Samples per chain = 1000
parameters        = nu, r_unit, r
internals         = lp, n_steps, is_accept, acceptance_rate, log_density, hamiltonian_energy, hamiltonian_energy_error, max_hamiltonian_energy_error, tree_depth, numerical_error, step_size, nom_step_size

Summary Statistics
 <span class=" -Color -Color-Bold"> parameters </span> <span class=" -Color -Color-Bold">    mean </span> <span class=" -Color -Color-Bold">     std </span> <span class=" -Color -Color-Bold"> naive_se </span> <span class=" -Color -Color-Bold">    mcse </span> <span class=" -Color -Color-Bold">      ess </span> <span class=" -Color -Color-Bold">    rhat </span>
      Symbol   Float64   Float64    Float64   Float64    Float64   Float64 

      r_unit    0.1848    0.6805     0.0215    0.0262   460.7023    1.0068
          nu    0.5830    0.3024     0.0096    0.0176   254.7408    0.9991
           r    0.0000    0.0000     0.0000    0.0000   460.7023    1.0068

Quantiles
 <span class=" -Color -Color-Bold"> parameters </span> <span class=" -Color -Color-Bold">    2.5% </span> <span class=" -Color -Color-Bold">   25.0% </span> <span class=" -Color -Color-Bold">   50.0% </span> <span class=" -Color -Color-Bold">   75.0% </span> <span class=" -Color -Color-Bold">   97.5% </span>
      Symbol   Float64   Float64   Float64   Float64   Float64 

      r_unit   -1.1717   -0.2107    0.1758    0.5655    1.5847
          nu    0.2478    0.3897    0.5052    0.6998    1.3493
           r    0.0000    0.0000    0.0000    0.0000    0.0000
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>┌ Warning: timestamp of type Missing unknown
└ @ MCMCChains /Users/wfarr/.julia/packages/MCMCChains/tfR90/src/chains.jl:364
┌ Warning: timestamp of type Missing unknown
└ @ MCMCChains /Users/wfarr/.julia/packages/MCMCChains/tfR90/src/chains.jl:364
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">StatsPlots</span></code> package knows how to plot MCMC traces:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">scaled_quad_trace</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/welcome_54_0.svg" src="_images/welcome_54_0.svg" /></div>
</div>
<p>What we see above in the left-hand column is the samples in each parameter that were drawn as a function of the iteration number.  We will talk in great detail about the NUTS/HMC algorithm and MCMC in general later in the course; for now, just know that the algorithm takes the “current” sample and evolves it according to a dynamical system to generate the “next” sample.  So there will be some degree of correlation from sample-to-sample; we want that to be as small as possible, so that the samples “mix” into the full posterior distribution (sometimes called the “target distribution”) quickly.  You can see in these plots that successive samples appear pretty random, so the mixing looks good.  This is also captured by the <code class="docutils literal notranslate"><span class="pre">ess</span></code> column in the textual output above, which gives (very roughly) the effective number of <em>independent</em> draws from the posterior distribution by estimating the sample-to-sample correlation.</p>
<p>What we see in the right-hand column is an estimate of the 1D density of the samples in each parameter; these are the “marginal” distributions of <span class="math notranslate nohighlight">\(r\)</span> (marginalized over all possible values of <span class="math notranslate nohighlight">\(\nu\)</span>) and <span class="math notranslate nohighlight">\(\nu\)</span> (marginalized over all possible values of <span class="math notranslate nohighlight">\(r\)</span>).</p>
<p>It is particularly interesting to look at the posterior density (i.e. our uncertainty about) the <span class="math notranslate nohighlight">\(\nu\)</span> parameter: it does not peak at <span class="math notranslate nohighlight">\(\nu = 1\)</span> (the point at which the quoted errorbars correctly represent the scatter in the observations).  In fact, <span class="math notranslate nohighlight">\(\nu = 1\)</span> lives quite far in the tail—only 7.1% of the posterior samples have <span class="math notranslate nohighlight">\(\nu &gt; 1\)</span>.</p>
<p>It looks like our guess that the uncertainties were over-estimated is correct!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">p_nu_gt_1</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">scaled_quad_trace</span><span class="p">[</span><span class="ss">:nu</span><span class="p">]</span> <span class="o">.&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">length</span><span class="p">(</span><span class="n">scaled_quad_trace</span><span class="p">)</span>
<span class="nd">@df</span> <span class="n">scaled_quad_trace</span> <span class="n">density</span><span class="p">(</span><span class="ss">:nu</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">u&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
<span class="n">vline!</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="ss">:black</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
<span class="n">title!</span><span class="p">(</span><span class="nd">@sprintf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\$</span><span class="s">P</span><span class="se">\\</span><span class="s">left( </span><span class="se">\\</span><span class="s">nu &gt; 1 </span><span class="se">\\</span><span class="s">right) = </span><span class="si">%.3f</span><span class="se">\$</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">p_nu_gt_1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/welcome_57_0.svg" src="_images/welcome_57_0.svg" /></div>
</div>
<p>Together with the re-scaled observational uncertainties, we can re-estimate the underlying response value; our estimate will become better, because the scale factor <span class="math notranslate nohighlight">\(\nu &lt; 1\)</span> so the errorbars that the model uses will be smaller than the quoted uncertainty.  The central estimate barely changes, though, because the <em>relative</em> contribution of each data point remains the same (mathematically: the factor <span class="math notranslate nohighlight">\(\nu\)</span> cancels in the formula for <span class="math notranslate nohighlight">\(\mu_r\)</span> in Eq. <a class="reference internal" href="#equation-weighted-mean">(1)</a> or <a class="reference internal" href="#equation-weighted-mean-posterior-mean">(8)</a>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">quad_data</span><span class="p">,</span> <span class="nb">nothing</span><span class="p">)</span>
<span class="n">plot_bands</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">scaled_quad_trace</span><span class="p">[</span><span class="ss">:r</span><span class="p">]),</span> <span class="n">std</span><span class="p">(</span><span class="n">scaled_quad_trace</span><span class="p">[</span><span class="ss">:r</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;Scaled Errors&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plot_bands</span><span class="p">(</span><span class="n">qr</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;Original Errors&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">title!</span><span class="p">(</span><span class="s">&quot;Quadrupole&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/welcome_59_0.svg" src="_images/welcome_59_0.svg" /></div>
</div>
<p>Now we can do the same thing for the octupole data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">scaled_oct_model</span> <span class="o">=</span> <span class="n">scaled_errorbar</span><span class="p">(</span><span class="n">oct_data</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">.*</span> <span class="p">(</span><span class="n">oct_data</span><span class="o">.</span><span class="n">sigma_lower</span> <span class="o">.+</span> <span class="n">oct_data</span><span class="o">.</span><span class="n">sigma_upper</span><span class="p">))</span>
<span class="n">scaled_oct_trace</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">scaled_oct_model</span><span class="p">,</span> <span class="n">NUTS</span><span class="p">(),</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">scaled_oct_genq</span> <span class="o">=</span> <span class="n">with_logger</span><span class="p">(</span><span class="n">NullLogger</span><span class="p">())</span> <span class="k">do</span> <span class="c"># Sometimes this throws a lot of warnings that we don&#39;t care about.</span>
    <span class="n">generated_quantities</span><span class="p">(</span><span class="n">scaled_oct_model</span><span class="p">,</span> <span class="n">scaled_oct_trace</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">scaled_oct_trace</span> <span class="o">=</span> <span class="n">append_generated_quantities</span><span class="p">(</span><span class="n">scaled_oct_trace</span><span class="p">,</span> <span class="n">scaled_oct_genq</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>┌ Info: Found initial step size
│   ϵ = 0.20078125000000002
└ @ Turing.Inference /Users/wfarr/.julia/packages/Turing/Ysmbf/src/inference/hmc.jl:188
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Chains MCMC chain (1000×15×1 Array{Float64, 3}):

Iterations        = 1:1:1000
Number of chains  = 1
Samples per chain = 1000
parameters        = nu, r_unit, r
internals         = lp, n_steps, is_accept, acceptance_rate, log_density, hamiltonian_energy, hamiltonian_energy_error, max_hamiltonian_energy_error, tree_depth, numerical_error, step_size, nom_step_size

Summary Statistics
 <span class=" -Color -Color-Bold"> parameters </span> <span class=" -Color -Color-Bold">    mean </span> <span class=" -Color -Color-Bold">     std </span> <span class=" -Color -Color-Bold"> naive_se </span> <span class=" -Color -Color-Bold">    mcse </span> <span class=" -Color -Color-Bold">      ess </span> <span class=" -Color -Color-Bold">    rhat </span>
      Symbol   Float64   Float64    Float64   Float64    Float64   Float64 

      r_unit   -0.1313    0.4620     0.0146    0.0288   321.1306    1.0003
          nu    1.6619    0.6181     0.0195    0.0325   371.8679    0.9990
           r    0.0000    0.0000     0.0000    0.0000   321.1306    1.0003

Quantiles
 <span class=" -Color -Color-Bold"> parameters </span> <span class=" -Color -Color-Bold">    2.5% </span> <span class=" -Color -Color-Bold">   25.0% </span> <span class=" -Color -Color-Bold">   50.0% </span> <span class=" -Color -Color-Bold">   75.0% </span> <span class=" -Color -Color-Bold">   97.5% </span>
      Symbol   Float64   Float64   Float64   Float64   Float64 

      r_unit   -1.0735   -0.4081   -0.1395    0.1483    0.8117
          nu    0.8802    1.2458    1.5113    1.9235    3.2372
           r    0.0000    0.0000    0.0000    0.0000    0.0000
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>┌ Warning: timestamp of type Missing unknown
└ @ MCMCChains /Users/wfarr/.julia/packages/MCMCChains/tfR90/src/chains.jl:364
┌ Warning: timestamp of type Missing unknown
└ @ MCMCChains /Users/wfarr/.julia/packages/MCMCChains/tfR90/src/chains.jl:364
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">scaled_oct_trace</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/welcome_62_0.svg" src="_images/welcome_62_0.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">p_nu_gt_1</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">scaled_oct_trace</span><span class="p">[</span><span class="ss">:nu</span><span class="p">]</span> <span class="o">.&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">length</span><span class="p">(</span><span class="n">scaled_oct_trace</span><span class="p">)</span>
<span class="nd">@df</span> <span class="n">scaled_oct_trace</span> <span class="n">density</span><span class="p">(</span><span class="ss">:nu</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">u&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
<span class="n">vline!</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="ss">:black</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
<span class="n">title!</span><span class="p">(</span><span class="nd">@sprintf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\$</span><span class="s">P</span><span class="se">\\</span><span class="s">left( </span><span class="se">\\</span><span class="s">nu &gt; 1 </span><span class="se">\\</span><span class="s">right) = </span><span class="si">%.3f</span><span class="se">\$</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">p_nu_gt_1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/welcome_63_0.svg" src="_images/welcome_63_0.svg" /></div>
</div>
<p>It looks like our supposition that these errorbars were <em>underestimated</em> is correct!  Re-computing our estimate for <span class="math notranslate nohighlight">\(r\)</span>, we see that the uncertainty has <em>grown</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">oct_data</span><span class="p">,</span> <span class="nb">nothing</span><span class="p">)</span>
<span class="n">plot_bands</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">scaled_oct_trace</span><span class="p">[</span><span class="ss">:r</span><span class="p">]),</span> <span class="n">std</span><span class="p">(</span><span class="n">scaled_oct_trace</span><span class="p">[</span><span class="ss">:r</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;Scaled Errors&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plot_bands</span><span class="p">(</span><span class="n">or</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;Original Errors&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">title!</span><span class="p">(</span><span class="s">&quot;Octupole&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/welcome_65_0.svg" src="_images/welcome_65_0.svg" /></div>
</div>
</div>
<div class="section" id="if-that-was-model-expansion-let-s-try-model-explosion">
<h2>If That Was Model “Expansion,” Let’s Try Model “Explosion”<a class="headerlink" href="#if-that-was-model-expansion-let-s-try-model-explosion" title="Permalink to this headline">¶</a></h2>
<p>At the risk of flogging a dead horse, let’s try one more model for these data.  In the last model, we <em>assumed</em> that the response value was constant across measurements (i.e. in frequency), and used this assumption to re-scale the quoted measurement uncertainty to match the actual scatter of the observations around the fixed response value.</p>
<p>What if, instead, we imagine that each experiment measured</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@model</span> <span class="k">function</span> <span class="n">normal_hierarchical</span><span class="p">(</span><span class="n">responses</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">)</span>
    <span class="n">mu_r_unit</span> <span class="o">~</span> <span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sigma_r_unit</span> <span class="o">~</span> <span class="n">truncated</span><span class="p">(</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Inf</span><span class="p">)</span>
    <span class="n">r_unit</span> <span class="o">~</span> <span class="n">filldist</span><span class="p">(</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">length</span><span class="p">(</span><span class="n">responses</span><span class="p">))</span>
    
    <span class="n">mu_r</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span> <span class="o">+</span> <span class="n">std</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span><span class="o">*</span><span class="n">mu_r_unit</span>
    <span class="n">sigma_r</span> <span class="o">=</span> <span class="n">std</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_r_unit</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">mu_r</span> <span class="o">.+</span> <span class="n">sigma_r</span><span class="o">.*</span><span class="n">r_unit</span>
    
    <span class="n">responses</span> <span class="o">~</span> <span class="n">arraydist</span><span class="p">([</span><span class="n">Normal</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">)])</span>
    
    <span class="n">r_pop</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu_r</span><span class="p">,</span> <span class="n">sigma_r</span><span class="p">))</span>
    
    <span class="p">(</span><span class="n">mu_r</span><span class="o">=</span><span class="n">mu_r</span><span class="p">,</span> <span class="n">sigma_r</span><span class="o">=</span><span class="n">sigma_r</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">r_pop</span><span class="o">=</span><span class="n">r_pop</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>normal_hierarchical (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">nhq</span> <span class="o">=</span> <span class="n">normal_hierarchical</span><span class="p">(</span><span class="n">quad_data</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">.*</span> <span class="p">(</span><span class="n">quad_data</span><span class="o">.</span><span class="n">sigma_lower</span> <span class="o">.+</span> <span class="n">quad_data</span><span class="o">.</span><span class="n">sigma_upper</span><span class="p">))</span>
<span class="n">nht</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">nhq</span><span class="p">,</span> <span class="n">NUTS</span><span class="p">(),</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">nhg</span> <span class="o">=</span> <span class="n">with_logger</span><span class="p">(</span><span class="n">NullLogger</span><span class="p">())</span> <span class="k">do</span> 
    <span class="n">generated_quantities</span><span class="p">(</span><span class="n">nhq</span><span class="p">,</span> <span class="n">nht</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">nht</span> <span class="o">=</span> <span class="n">append_generated_quantities</span><span class="p">(</span><span class="n">nht</span><span class="p">,</span> <span class="n">nhg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>┌ Info: Found initial step size
│   ϵ = 0.4
└ @ Turing.Inference /Users/wfarr/.julia/packages/Turing/Ysmbf/src/inference/hmc.jl:188
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Chains MCMC chain (1000×25×1 Array{Float64, 3}):

Iterations        = 1:1:1000
Number of chains  = 1
Samples per chain = 1000
parameters        = sigma_r_unit, mu_r_unit, r_unit[3], r_unit[2], r_unit[1], r_unit[4], mu_r, sigma_r, r[3], r[1], r[4], r[2], r_pop
internals         = lp, n_steps, is_accept, acceptance_rate, log_density, hamiltonian_energy, hamiltonian_energy_error, max_hamiltonian_energy_error, tree_depth, numerical_error, step_size, nom_step_size

Summary Statistics
 <span class=" -Color -Color-Bold">   parameters </span> <span class=" -Color -Color-Bold">    mean </span> <span class=" -Color -Color-Bold">     std </span> <span class=" -Color -Color-Bold"> naive_se </span> <span class=" -Color -Color-Bold">    mcse </span> <span class=" -Color -Color-Bold">      ess </span> <span class=" -Color -Color-Bold">    rhat </span>
        Symbol   Float64   Float64    Float64   Float64    Float64   Float64 

     mu_r_unit    0.0329    0.7962     0.0252    0.0310   946.4034    0.9996
  sigma_r_unit    0.6229    0.4965     0.0157    0.0218   698.3802    0.9998
     r_unit[1]   -0.0653    0.9955     0.0315    0.0243   844.0865    0.9990
     r_unit[2]    0.1735    1.0120     0.0320    0.0426   857.4261    1.0047
     r_unit[3]   -0.0336    0.9204     0.0291    0.0428   679.6046    0.9995
     r_unit[4]    0.0067    0.9357     0.0296    0.0299   989.4566    1.0006
          mu_r    0.0000    0.0000     0.0000    0.0000   946.4034    0.9996
       sigma_r    0.0000    0.0000     0.0000    0.0000   698.3802    0.9998
          r[1]    0.0000    0.0000     0.0000    0.0000   885.1013    0.9991
          r[2]    0.0000    0.0000     0.0000    0.0000   925.2406    0.9997
          r[3]    0.0000    0.0000     0.0000    0.0000   942.6550    0.9997
          r[4]    0.0000    0.0000     0.0000    0.0000   917.9220    0.9993
         r_pop    0.0000    0.0000     0.0000    0.0000   908.9306    1.0005

Quantiles
 <span class=" -Color -Color-Bold">   parameters </span> <span class=" -Color -Color-Bold">    2.5% </span> <span class=" -Color -Color-Bold">   25.0% </span> <span class=" -Color -Color-Bold">   50.0% </span> <span class=" -Color -Color-Bold">   75.0% </span> <span class=" -Color -Color-Bold">   97.5% </span>
        Symbol   Float64   Float64   Float64   Float64   Float64 

     mu_r_unit   -1.4754   -0.5302    0.0193    0.6045    1.5260
  sigma_r_unit    0.0214    0.2424    0.5027    0.8960    1.8236
     r_unit[1]   -2.0881   -0.7378   -0.0871    0.5763    1.9590
     r_unit[2]   -1.8452   -0.5425    0.1676    0.8680    2.1519
     r_unit[3]   -1.6986   -0.6855   -0.0231    0.5826    1.8020
     r_unit[4]   -1.8289   -0.6199    0.0025    0.6280    1.8441
          mu_r    0.0000    0.0000    0.0000    0.0000    0.0000
       sigma_r    0.0000    0.0000    0.0000    0.0000    0.0000
          r[1]    0.0000    0.0000    0.0000    0.0000    0.0000
          r[2]    0.0000    0.0000    0.0000    0.0000    0.0000
          r[3]    0.0000    0.0000    0.0000    0.0000    0.0000
          r[4]    0.0000    0.0000    0.0000    0.0000    0.0000
         r_pop    0.0000    0.0000    0.0000    0.0000    0.0000
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>┌ Warning: timestamp of type Missing unknown
└ @ MCMCChains /Users/wfarr/.julia/packages/MCMCChains/tfR90/src/chains.jl:364
┌ Warning: timestamp of type Missing unknown
└ @ MCMCChains /Users/wfarr/.julia/packages/MCMCChains/tfR90/src/chains.jl:364
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">marginalkde</span><span class="p">(</span><span class="n">vec</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">mu_r</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">nhg</span><span class="p">]),</span> <span class="n">vec</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">sigma_r</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">nhg</span><span class="p">]),</span> <span class="n">xlabel</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;\mu_r&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;\sigma_r&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/welcome_70_0.svg" src="_images/welcome_70_0.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">nho</span> <span class="o">=</span> <span class="n">normal_hierarchical</span><span class="p">(</span><span class="n">oct_data</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">.*</span> <span class="p">(</span><span class="n">oct_data</span><span class="o">.</span><span class="n">sigma_lower</span> <span class="o">.+</span> <span class="n">oct_data</span><span class="o">.</span><span class="n">sigma_upper</span><span class="p">))</span>
<span class="n">nht</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">nho</span><span class="p">,</span> <span class="n">NUTS</span><span class="p">(),</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">nhg</span> <span class="o">=</span> <span class="n">with_logger</span><span class="p">(</span><span class="n">NullLogger</span><span class="p">())</span> <span class="k">do</span> 
    <span class="n">generated_quantities</span><span class="p">(</span><span class="n">nho</span><span class="p">,</span> <span class="n">nht</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">nht</span> <span class="o">=</span> <span class="n">append_generated_quantities</span><span class="p">(</span><span class="n">nht</span><span class="p">,</span> <span class="n">nhg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>┌ Info: Found initial step size
│   ϵ = 0.05
└ @ Turing.Inference /Users/wfarr/.julia/packages/Turing/Ysmbf/src/inference/hmc.jl:188
<span class=" -Color -Color-Green">Sampling: 100%|█████████████████████████████████████████| Time: 0:00:00</span>
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Chains MCMC chain (1000×27×1 Array{Float64, 3}):

Iterations        = 1:1:1000
Number of chains  = 1
Samples per chain = 1000
parameters        = sigma_r_unit, mu_r_unit, r_unit[3], r_unit[2], r_unit[1], r_unit[4], r_unit[5], mu_r, sigma_r, r[3], r[1], r[4], r[2], r[5], r_pop
internals         = lp, n_steps, is_accept, acceptance_rate, log_density, hamiltonian_energy, hamiltonian_energy_error, max_hamiltonian_energy_error, tree_depth, numerical_error, step_size, nom_step_size

Summary Statistics
 <span class=" -Color -Color-Bold">   parameters </span> <span class=" -Color -Color-Bold">    mean </span> <span class=" -Color -Color-Bold">     std </span> <span class=" -Color -Color-Bold"> naive_se </span> <span class=" -Color -Color-Bold">    mcse </span> <span class=" -Color -Color-Bold">      ess </span> <span class=" -Color -Color-Bold">    rhat </span>
        Symbol   Float64   Float64    Float64   Float64    Float64   Float64 

     mu_r_unit   -0.0661    0.3927     0.0124    0.0243   168.2363    1.0062
  sigma_r_unit    0.6694    0.3896     0.0123    0.0235   214.4093    1.0055
     r_unit[1]    0.4198    0.8212     0.0260    0.0226   439.1814    0.9996
     r_unit[2]   -0.4937    0.8593     0.0272    0.0457   344.1892    0.9990
     r_unit[3]    0.8513    0.8241     0.0261    0.0362   359.4401    0.9990
     r_unit[4]   -0.7009    0.7872     0.0249    0.0325   296.5321    1.0023
     r_unit[5]   -0.2066    0.7640     0.0242    0.0288   313.1333    0.9996
          mu_r    0.0000    0.0000     0.0000    0.0000   168.2363    1.0062
       sigma_r    0.0000    0.0000     0.0000    0.0000   214.4093    1.0055
          r[1]    0.0000    0.0000     0.0000    0.0000   354.5386    1.0086
          r[2]    0.0000    0.0000     0.0000    0.0000   483.6084    0.9991
          r[3]    0.0000    0.0000     0.0000    0.0000   463.7658    1.0053
          r[4]    0.0000    0.0000     0.0000    0.0000   540.4770    0.9991
          r[5]    0.0000    0.0000     0.0000    0.0000   598.2623    0.9992
         r_pop    0.0000    0.0000     0.0000    0.0000   490.6647    0.9991

Quantiles
 <span class=" -Color -Color-Bold">   parameters </span> <span class=" -Color -Color-Bold">    2.5% </span> <span class=" -Color -Color-Bold">   25.0% </span> <span class=" -Color -Color-Bold">   50.0% </span> <span class=" -Color -Color-Bold">   75.0% </span> <span class=" -Color -Color-Bold">   97.5% </span>
        Symbol   Float64   Float64   Float64   Float64   Float64 

     mu_r_unit   -1.0071   -0.3077   -0.0615    0.2143    0.6558
  sigma_r_unit    0.0675    0.3825    0.6133    0.9014    1.5988
     r_unit[1]   -1.1885   -0.1144    0.4366    0.9790    2.0127
     r_unit[2]   -2.1261   -1.0774   -0.5138    0.0378    1.3036
     r_unit[3]   -0.7318    0.2898    0.8219    1.3855    2.5939
     r_unit[4]   -2.2427   -1.1916   -0.7097   -0.2236    0.9162
     r_unit[5]   -1.6660   -0.6929   -0.2081    0.2580    1.5107
          mu_r    0.0000    0.0000    0.0000    0.0000    0.0000
       sigma_r    0.0000    0.0000    0.0000    0.0000    0.0000
          r[1]    0.0000    0.0000    0.0000    0.0000    0.0000
          r[2]    0.0000    0.0000    0.0000    0.0000    0.0000
          r[3]    0.0000    0.0000    0.0000    0.0000    0.0000
          r[4]    0.0000    0.0000    0.0000    0.0000    0.0000
          r[5]    0.0000    0.0000    0.0000    0.0000    0.0000
         r_pop    0.0000    0.0000    0.0000    0.0000    0.0000
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>┌ Warning: timestamp of type Missing unknown
└ @ MCMCChains /Users/wfarr/.julia/packages/MCMCChains/tfR90/src/chains.jl:364
┌ Warning: timestamp of type Missing unknown
└ @ MCMCChains /Users/wfarr/.julia/packages/MCMCChains/tfR90/src/chains.jl:364
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">marginalkde</span><span class="p">(</span><span class="n">vec</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">mu_r</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">nhg</span><span class="p">]),</span> <span class="n">vec</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">sigma_r</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">nhg</span><span class="p">]),</span> <span class="n">xlabel</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;\mu_r&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;\sigma_r&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/welcome_72_0.svg" src="_images/welcome_72_0.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">density</span><span class="p">(</span><span class="n">nht</span><span class="p">[</span><span class="s">&quot;r[3]&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;r_3&quot;</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="mf">1.5e-11</span><span class="o">:</span><span class="mf">1e-13</span><span class="o">:</span><span class="mf">1.75e-11</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">pdf</span><span class="o">.</span><span class="p">(</span><span class="n">Normal</span><span class="p">(</span><span class="n">oct_data</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">oct_data</span><span class="o">.</span><span class="n">sigma</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="n">rs</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="ss">:black</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;x_3&quot;</span><span class="p">)</span>
<span class="n">density!</span><span class="p">(</span><span class="n">nht</span><span class="p">[</span><span class="ss">:r_pop</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">L</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/welcome_73_0.svg" src="_images/welcome_73_0.svg" /></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.6"
        },
        kernelOptions: {
            kernelName: "julia-1.6",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.6'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="intro.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">PHY 688: Numerical Methods in Astrophysics.</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="syllabus.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">PHY 688: Computational Astrophysics Syllabus</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Will M. Farr<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>